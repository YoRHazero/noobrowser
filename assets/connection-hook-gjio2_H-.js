import{r as p,j as c,c as Ur,n as Br,aD as zr,aE as $r,aF as I,aG as Gr,aH as qr,aI as Ae,s as ge,w as $e,e as M,m as g,d as P,v as Ge,h as bt,u as wt,aJ as Wr,aK as Hr,x as St,aL as Kr,aM as Qr,aN as Jr,aO as Zr,aP as Xr,aQ as Yr,aR as eo,aS as to,aT as ro,aU as oo,aV as no,aW as oe,q as so,f as V,aX as io,aY as ao,aZ as co,a_ as lo,a$ as uo,b0 as fo,b1 as po,b2 as ho,l as kt,b3 as mo,b4 as go,I as Po,S as H,am as xt,ap as _t,b5 as tt,b6 as yo,az as K,b7 as Co,aB as Rt,ar as Tt,aA as vo,b8 as bo,b9 as wo,H as So,ba as ko,t as ue,bb as xo}from"./index-DTfHgk7v.js";import{c as Et,Q as Nt,d as _o,e as Ro,f as To,g as Eo,h as No,s as rt,i as ot,w as Ao,j as Io,k as X,p as At,l as Fo,u as F,a as It,b as E}from"./connection-Dy1eGPll.js";import{c as x}from"./create-split-props-u5h9OPvL.js";import{F as Oo}from"./for-C-OR-lR2.js";const jo=p.forwardRef(function(t,r){const{templateAreas:o,column:n,row:s,autoFlow:i,autoRows:a,templateRows:f,autoColumns:l,templateColumns:u,inline:m,...h}=t;return c.jsx(Ur.div,{...h,ref:r,css:[{display:m?"inline-grid":"grid",gridTemplateAreas:o,gridAutoColumns:l,gridColumn:n,gridRow:s,gridAutoFlow:i,gridAutoRows:a,gridTemplateRows:f,gridTemplateColumns:u},t.css]})});jo.displayName="Grid";const Ft=e=>x()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]);function Mo(e,t){const{state:r,send:o,context:n}=e,s=r.matches("mounted","unmountSuspended");return{skip:!n.get("initial"),present:s,setNode(i){i&&o({type:"NODE.SET",node:i})},unmount(){o({type:"UNMOUNT"})}}}var Vo=Br({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,prop:t,send:r}){e([()=>t("present")],()=>{r({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e,refs:t})=>{e("onExitComplete")?.();const r=t.get("node");if(!r)return;const o=qr(r),n=new o.CustomEvent("exitcomplete",{bubbles:!1});r.dispatchEvent(n)},setupNode:({refs:e,event:t})=>{e.get("node")!==t.node&&(e.set("node",t.node),e.set("styles",Gr(t.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:t,send:r,prop:o})=>{const n=o("present");if(n)return r({type:"MOUNT",src:"presence.changed"});const s=t.get("node");if(!n&&s?.ownerDocument.visibilityState==="hidden")return r({type:"UNMOUNT",src:"visibilitychange"});I(()=>{const i=ne(t.get("styles"));e.set("unmountAnimationName",i),i==="none"||i===e.get("prevAnimationName")||t.get("styles")?.display==="none"||t.get("styles")?.animationDuration==="0s"?r({type:"UNMOUNT",src:"presence.changed"}):r({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{I(()=>{e.set("prevAnimationName",ne(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:r,prop:o})=>{const n=t.get("node");if(!n)return;const s=l=>{(l.composedPath?.()?.[0]??l.target)===n&&e.set("prevAnimationName",ne(t.get("styles")))},i=l=>{const u=ne(t.get("styles"));Ae(l)===n&&u===e.get("unmountAnimationName")&&!o("present")&&r({type:"UNMOUNT",src:"animationend"})},a=l=>{Ae(l)===n&&!o("present")&&r({type:"UNMOUNT",src:"animationcancel"})};n.addEventListener("animationstart",s),n.addEventListener("animationcancel",a),n.addEventListener("animationend",i);const f=zr(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",s),n.removeEventListener("animationcancel",a),n.removeEventListener("animationend",i),$r(()=>f())}}}}});function ne(e){return e?.animationName||"none"}ge()(["onExitComplete","present","immediate"]);function Do(e,t={}){const{sync:r=!1}=t,o=Lo(e);return p.useCallback((...n)=>r?queueMicrotask(()=>o.current?.(...n)):o.current?.(...n),[r,o])}function Lo(e){const t=p.useRef(e);return t.current=e,t}const qe=(e={})=>{const{lazyMount:t,unmountOnExit:r,present:o,skipAnimationOnMount:n=!1,...s}=e,i=p.useRef(!1),a={...s,present:o,onExitComplete:Do(e.onExitComplete)},f=$e(Vo,a),l=Mo(f);l.present&&(i.current=!0);const u=!l.present&&!i.current&&t||r&&!l.present&&i.current,m=()=>({"data-state":l.skip&&n?void 0:o?"open":"closed",hidden:!l.present});return{ref:l.setNode,getPresenceProps:m,present:l.present,unmounted:u}},[We,Ot]=M({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),[jt,Uo]=M({name:"RenderStrategyContext",hookName:"useRenderStrategyContext",providerName:"<RenderStrategyPropsProvider />"}),Mt=e=>x()(e,["lazyMount","unmountOnExit"]),[Bo,Vt]=M({name:"ColorPickerAreaContext",hookName:"useColorPickerAreaContext",providerName:"<ColorPickerAreaProvider />"}),[Dt,v]=M({name:"ColorPickerContext",hookName:"useColorPickerContext",providerName:"<ColorPickerProvider />"}),zo=x(),Lt=p.forwardRef((e,t)=>{const[r,o]=zo(e,["xChannel","yChannel"]),n=v(),s=g(n.getAreaProps(r),o);return c.jsx(Bo,{value:r,children:c.jsx(P.div,{...s,ref:t})})});Lt.displayName="ColorPickerArea";const Ut=p.forwardRef((e,t)=>{const r=v(),o=Vt(),n=g(r.getAreaBackgroundProps(o),e);return c.jsx(P.div,{...n,ref:t})});Ut.displayName="ColorPickerAreaBackground";const Bt=p.forwardRef((e,t)=>{const r=v(),o=Vt(),n=g(r.getAreaThumbProps(o),e);return c.jsx(P.div,{...n,ref:t})});Bt.displayName="ColorPickerAreaThumb";const $o=x(),zt=p.forwardRef((e,t)=>{const[r,o]=$o(e,["channel","orientation"]),n=v(),s=g(n.getChannelInputProps(r),o);return c.jsx(P.input,{...s,ref:t})});zt.displayName="ColorPickerChannelInput";const[Go,Pe]=M({name:"ColorPickerChannelSliderContext",hookName:"useColorPickerChannelSliderContext",providerName:"<ColorPickerChannelSliderProvider />"}),[qo,He]=M({name:"ColorPickerFormatContext",hookName:"useColorPickerFormatPropsContext",providerName:"<ColorPickerFormatPropsProvider />",strict:!1}),Wo=x(),$t=p.forwardRef((e,t)=>{const[r,o]=Wo(e,["channel","orientation"]),n=v(),s=He(),i={...r,...s},a=g(n.getChannelSliderProps(i),o);return c.jsx(Go,{value:r,children:c.jsx(P.div,{...a,ref:t})})});$t.displayName="ColorPickerChannelSlider";const Gt=p.forwardRef((e,t)=>{const r=v(),o=Pe(),n=g(r.getChannelSliderLabelProps(o),e);return c.jsx(P.label,{...n,ref:t})});Gt.displayName="ColorPickerChannelSliderLabel";const qt=p.forwardRef((e,t)=>{const r=v(),o=Pe(),n=He(),s={...o,...n},i=g(r.getChannelSliderThumbProps(s),e);return c.jsx(P.div,{...i,ref:t})});qt.displayName="ColorPickerChannelSliderThumb";const Wt=p.forwardRef((e,t)=>{const r=v(),o=Pe(),n=He(),s={...o,...n},i=g(r.getChannelSliderTrackProps(s),e);return c.jsx(P.div,{...i,ref:t})});Wt.displayName="ColorPickerChannelSliderTrack";const Ht=p.forwardRef((e,t)=>{const{locale:r}=Ge(),o=v(),n=Pe(),s=g(o.getChannelSliderValueTextProps(n),e);return c.jsx(P.span,{...s,ref:t,children:e.children||o.getChannelValueText(n.channel,r)})});Ht.displayName="ColorPickerChannelSliderValueText";const Kt=p.forwardRef((e,t)=>{const r=v(),o=Ot(),n=g(r.getContentProps(),o.getPresenceProps(),e);return o.unmounted?null:c.jsx(P.div,{...n,ref:bt(o.ref,t)})});Kt.displayName="ColorPickerContent";const Qt=p.forwardRef((e,t)=>{const r=v(),o=g(r.getControlProps(),e);return c.jsx(P.div,{...o,ref:t})});Qt.displayName="ColorPickerControl";const Jt=p.forwardRef((e,t)=>{const r=v(),o=g(r.getEyeDropperTriggerProps(),e);return c.jsx(P.button,{...o,ref:t})});Jt.displayName="ColorPickerEyeDropperTrigger";const Zt=p.forwardRef((e,t)=>{const r=v(),o=g(r.getFormatSelectProps(),e);return c.jsx(P.select,{...o,ref:t,children:["rgba","hsla","hsba"].map(n=>c.jsx(P.option,{value:n,children:n},n))})});Zt.displayName="ColorPickerFormatSelect";const Xt=p.forwardRef((e,t)=>{const r=v(),o=g(r.getFormatTriggerProps(),e);return c.jsx(P.button,{...o,ref:t})});Xt.displayName="ColorPickerFormatTrigger";const Yt=p.forwardRef((e,t)=>{const r=v(),o=g(r.getHiddenInputProps(),e),n=Et();return c.jsx(P.input,{"aria-describedby":n?.ariaDescribedby,...o,ref:t})});Yt.displayName="ColorPickerHiddenInput";const er=p.forwardRef((e,t)=>{const r=v(),o=g(r.getLabelProps(),e);return c.jsx(P.label,{...o,ref:t})});er.displayName="ColorPickerLabel";const tr=p.forwardRef((e,t)=>{const r=v(),o=g(r.getPositionerProps(),e);return Ot().unmounted?null:c.jsx(P.div,{...o,ref:t})});tr.displayName="ColorPickerPositioner";const Ho=e=>{const t=p.useId(),{getRootNode:r}=wt(),{dir:o}=Ge(),n=Et(),s={id:t,ids:{label:n?.ids.label,input:n?.ids.control},dir:o,disabled:n?.disabled,invalid:n?.invalid,readOnly:n?.readOnly,required:n?.required,getRootNode:r,...e},i=$e(Wr,s);return Hr(i,St)},Ko=x(),rr=p.forwardRef((e,t)=>{const[r,o]=Ft(e),[n,s]=Ko(o,["closeOnSelect","defaultOpen","defaultValue","defaultFormat","disabled","format","id","ids","initialFocusEl","invalid","name","name","onFocusOutside","onFormatChange","onInteractOutside","onOpenChange","onPointerDownOutside","onValueChange","onValueChangeEnd","open","openAutoFocus","positioning","readOnly","required","inline","value"]),i=Ho(n),a=qe(g({present:i.open},r)),f=g(i.getRootProps(),s);return c.jsx(Dt,{value:i,children:c.jsx(We,{value:a,children:c.jsx(P.div,{...f,ref:t})})})});rr.displayName="ColorPickerRoot";const Qo=x(),or=p.forwardRef((e,t)=>{const[r,o]=Ft(e),[{value:n},s]=Qo(o,["value"]),i=qe(g({present:n.open},r)),a=g(n.getRootProps(),s);return c.jsx(Dt,{value:n,children:c.jsx(We,{value:i,children:c.jsx(P.div,{...a,ref:t})})})});or.displayName="ColorPickerRootProvider";const[nr,Jo]=M({name:"ColorPickerSwatchContext",hookName:"useColorPickerSwatchContext",providerName:"<ColorPickerSwatchProvider />"}),Zo=x(),sr=p.forwardRef((e,t)=>{const[r,o]=Zo(e,["respectAlpha","value"]),n=v(),s=g(n.getSwatchProps(r),o);return c.jsx(nr,{value:r,children:c.jsx(P.div,{...s,ref:t})})});sr.displayName="ColorPickerSwatch";const ir=p.forwardRef((e,t)=>{const r=v(),o=g(r.getSwatchGroupProps(),e);return c.jsx(P.div,{...o,ref:t})});ir.displayName="ColorPickerSwatchGroup";const ar=p.forwardRef((e,t)=>{const r=v(),o=Jo(),n=g(r.getSwatchIndicatorProps(o),e);return c.jsx(P.div,{...n,ref:t})});ar.displayName="ColorPickerSwatchIndicator";const Xo=x(),cr=p.forwardRef((e,t)=>{const[r,o]=Xo(e,["value","disabled"]),n=v(),s=g(n.getSwatchTriggerProps(r),o);return c.jsx(P.button,{...s,ref:t})});cr.displayName="ColorPickerSwatchTrigger";const Yo=x(),lr=p.forwardRef((e,t)=>{const[r,o]=Yo(e,["size"]),n=v(),s=g(n.getTransparencyGridProps(r),o);return c.jsx(P.div,{...s,ref:t})});lr.displayName="ColorPickerTransparencyGrid";const ur=p.forwardRef((e,t)=>{const r=v(),o=g(r.getTriggerProps(),e);return c.jsx(P.button,{...o,ref:t})});ur.displayName="ColorPickerTrigger";const en=x(),dr=p.forwardRef((e,t)=>{const[{respectAlpha:r},o]=en(e,["respectAlpha"]),n=v(),s={respectAlpha:r,value:n.valueAsString},i=g(n.getSwatchProps(s),o);return c.jsx(nr,{value:s,children:c.jsx(P.div,{...i,ref:t})})});dr.displayName="ColorPickerValueSwatch";const fr=p.forwardRef((e,t)=>{const{children:r,format:o,...n}=e,s=v(),i=g(s.getValueTextProps(),n),a=o?s.value.toString(o):s.valueAsString;return c.jsx(P.span,{...i,ref:t,children:r||a})});fr.displayName="ColorPickerValueText";const tn=x(),pr=p.forwardRef((e,t)=>{const r=v(),[o,n]=tn(e,["format"]);return r.format!==o.format?null:c.jsx(qo,{value:o,children:c.jsx(P.div,{ref:t,"data-format":e.format,...Kr.build().view.attrs,...n})})});pr.displayName="ColorPickerView";const[hr,ye]=M({name:"TabsContext",hookName:"useTabsContext",providerName:"<TabsProvider />"}),rn=x(),mr=p.forwardRef((e,t)=>{const[r,o]=rn(e,["value"]),n=ye(),s=Uo(),i=qe({...s,present:n.value===e.value,immediate:!0}),a=g(n.getContentProps(r),i.getPresenceProps(),o);return c.jsx(We,{value:i,children:i.unmounted?null:c.jsx(P.div,{...a,ref:bt(i.ref,t)})})});mr.displayName="TabContent";const gr=p.forwardRef((e,t)=>{const r=ye(),o=g(r.getIndicatorProps(),e);return c.jsx(P.div,{...o,ref:t})});gr.displayName="TabIndicator";const Pr=p.forwardRef((e,t)=>{const r=ye(),o=g(r.getListProps(),e);return c.jsx(P.div,{...o,ref:t})});Pr.displayName="TabList";const on=x(),yr=p.forwardRef((e,t)=>{const[r,o]=on(e,["disabled","value"]),n=ye(),s=g(n.getTriggerProps(r),o);return c.jsx(P.button,{...s,ref:t})});yr.displayName="TabTrigger";var nn=so("tabs").parts("root","list","trigger","content","indicator"),G=nn.build(),sn=e=>e.ids?.root??`tabs:${e.id}`,W=e=>e.ids?.list??`tabs:${e.id}:list`,Ie=(e,t)=>e.ids?.content?.(t)??`tabs:${e.id}:content-${t}`,D=(e,t)=>e.ids?.trigger?.(t)??`tabs:${e.id}:trigger-${t}`,Cr=e=>e.ids?.indicator??`tabs:${e.id}:indicator`,an=e=>e.getById(W(e)),cn=(e,t)=>e.getById(Ie(e,t)),ae=(e,t)=>t!=null?e.getById(D(e,t)):null,nt=e=>e.getById(Cr(e)),z=e=>{const r=`[role=tab][data-ownedby='${CSS.escape(W(e))}']:not([disabled])`;return po(an(e),r)},ln=e=>oo(z(e)),un=e=>ro(z(e)),dn=(e,t)=>to(z(e),D(e,t.value),t.loopFocus),fn=(e,t)=>eo(z(e),D(e,t.value),t.loopFocus),vr=e=>({x:e?.offsetLeft??0,y:e?.offsetTop??0,width:e?.offsetWidth??0,height:e?.offsetHeight??0}),pn=(e,t)=>{const r=ho(z(e),D(e,t));return vr(r)};function hn(e,t){const{state:r,send:o,context:n,prop:s,scope:i}=e,a=s("translations"),f=r.matches("focused"),l=s("orientation")==="vertical",u=s("orientation")==="horizontal",m=s("composite");function h(d){return{selected:n.get("value")===d.value,focused:n.get("focusedValue")===d.value,disabled:!!d.disabled}}return{value:n.get("value"),focusedValue:n.get("focusedValue"),setValue(d){o({type:"SET_VALUE",value:d})},clearValue(){o({type:"CLEAR_VALUE"})},setIndicatorRect(d){const y=D(i,d);o({type:"SET_INDICATOR_RECT",id:y})},syncTabIndex(){o({type:"SYNC_TAB_INDEX"})},selectNext(d){o({type:"TAB_FOCUS",value:d,src:"selectNext"}),o({type:"ARROW_NEXT",src:"selectNext"})},selectPrev(d){o({type:"TAB_FOCUS",value:d,src:"selectPrev"}),o({type:"ARROW_PREV",src:"selectPrev"})},focus(){const d=n.get("value");d&&ae(i,d)?.focus()},getRootProps(){return t.element({...G.root.attrs,id:sn(i),"data-orientation":s("orientation"),"data-focus":V(f),dir:s("dir")})},getListProps(){return t.element({...G.list.attrs,id:W(i),role:"tablist",dir:s("dir"),"data-focus":V(f),"aria-orientation":s("orientation"),"data-orientation":s("orientation"),"aria-label":a?.listLabel,onKeyDown(d){if(d.defaultPrevented||co(d)||!lo(d.currentTarget,Ae(d)))return;const y={ArrowDown(){u||o({type:"ARROW_NEXT",key:"ArrowDown"})},ArrowUp(){u||o({type:"ARROW_PREV",key:"ArrowUp"})},ArrowLeft(){l||o({type:"ARROW_PREV",key:"ArrowLeft"})},ArrowRight(){l||o({type:"ARROW_NEXT",key:"ArrowRight"})},Home(){o({type:"HOME"})},End(){o({type:"END"})}};let C=uo(d,{dir:s("dir"),orientation:s("orientation")});const w=y[C];if(w){d.preventDefault(),w(d);return}}})},getTriggerState:h,getTriggerProps(d){const{value:y,disabled:C}=d,w=h(d);return t.button({...G.trigger.attrs,role:"tab",type:"button",disabled:C,dir:s("dir"),"data-orientation":s("orientation"),"data-disabled":V(C),"aria-disabled":C,"data-value":y,"aria-selected":w.selected,"data-selected":V(w.selected),"data-focus":V(w.focused),"aria-controls":w.selected?Ie(i,y):void 0,"data-ownedby":W(i),"data-ssr":V(n.get("ssr")),id:D(i,y),tabIndex:w.selected&&m?0:-1,onFocus(){o({type:"TAB_FOCUS",value:y})},onBlur(S){S.relatedTarget?.getAttribute("role")!=="tab"&&o({type:"TAB_BLUR"})},onClick(S){S.defaultPrevented||io(S)||C||(ao()&&S.currentTarget.focus(),o({type:"TAB_CLICK",value:y}))}})},getContentProps(d){const{value:y}=d,C=n.get("value")===y;return t.element({...G.content.attrs,dir:s("dir"),id:Ie(i,y),tabIndex:m?0:-1,"aria-labelledby":D(i,y),role:"tabpanel","data-ownedby":W(i),"data-selected":V(C),"data-orientation":s("orientation"),hidden:!C})},getIndicatorProps(){const d=n.get("indicatorRect");return t.element({id:Cr(i),...G.indicator.attrs,dir:s("dir"),"data-orientation":s("orientation"),hidden:d==null,style:{"--transition-property":"left, right, top, bottom, width, height","--left":oe(d?.x),"--top":oe(d?.y),"--width":oe(d?.width),"--height":oe(d?.height),position:"absolute",willChange:"var(--transition-property)",transitionProperty:"var(--transition-property)",transitionDuration:"var(--transition-duration, 150ms)",transitionTimingFunction:"var(--transition-timing-function)",[u?"left":"top"]:u?"var(--left)":"var(--top)"}})}}}var{createMachine:mn}=Qr(),gn=mn({props({props:e}){return{dir:"ltr",orientation:"horizontal",activationMode:"automatic",loopFocus:!0,composite:!0,navigate(t){no(t.node)},defaultValue:null,...e}},initialState(){return"idle"},context({prop:e,bindable:t}){return{value:t(()=>({defaultValue:e("defaultValue"),value:e("value"),onChange(r){e("onValueChange")?.({value:r})}})),focusedValue:t(()=>({defaultValue:e("value")||e("defaultValue"),sync:!0,onChange(r){e("onFocusChange")?.({focusedValue:r})}})),ssr:t(()=>({defaultValue:!0})),indicatorRect:t(()=>({defaultValue:null}))}},watch({context:e,prop:t,track:r,action:o}){r([()=>e.get("value")],()=>{o(["syncIndicatorRect","syncTabIndex","navigateIfNeeded"])}),r([()=>t("dir"),()=>t("orientation")],()=>{o(["syncIndicatorRect"])})},on:{SET_VALUE:{actions:["setValue"]},CLEAR_VALUE:{actions:["clearValue"]},SET_INDICATOR_RECT:{actions:["setIndicatorRect"]},SYNC_TAB_INDEX:{actions:["syncTabIndex"]}},entry:["syncIndicatorRect","syncTabIndex","syncSsr"],exit:["cleanupObserver"],states:{idle:{on:{TAB_FOCUS:{target:"focused",actions:["setFocusedValue"]},TAB_CLICK:{target:"focused",actions:["setFocusedValue","setValue"]}}},focused:{on:{TAB_CLICK:{actions:["setFocusedValue","setValue"]},ARROW_PREV:[{guard:"selectOnFocus",actions:["focusPrevTab","selectFocusedTab"]},{actions:["focusPrevTab"]}],ARROW_NEXT:[{guard:"selectOnFocus",actions:["focusNextTab","selectFocusedTab"]},{actions:["focusNextTab"]}],HOME:[{guard:"selectOnFocus",actions:["focusFirstTab","selectFocusedTab"]},{actions:["focusFirstTab"]}],END:[{guard:"selectOnFocus",actions:["focusLastTab","selectFocusedTab"]},{actions:["focusLastTab"]}],TAB_FOCUS:{actions:["setFocusedValue"]},TAB_BLUR:{target:"idle",actions:["clearFocusedValue"]}}}},implementations:{guards:{selectOnFocus:({prop:e})=>e("activationMode")==="automatic"},actions:{selectFocusedTab({context:e,prop:t}){I(()=>{const r=e.get("focusedValue");if(!r)return;const n=t("deselectable")&&e.get("value")===r?null:r;e.set("value",n)})},setFocusedValue({context:e,event:t,flush:r}){t.value!=null&&r(()=>{e.set("focusedValue",t.value)})},clearFocusedValue({context:e}){e.set("focusedValue",null)},setValue({context:e,event:t,prop:r}){const o=r("deselectable")&&e.get("value")===e.get("focusedValue");e.set("value",o?null:t.value)},clearValue({context:e}){e.set("value",null)},focusFirstTab({scope:e}){I(()=>{ln(e)?.focus()})},focusLastTab({scope:e}){I(()=>{un(e)?.focus()})},focusNextTab({context:e,prop:t,scope:r,event:o}){const n=o.value??e.get("focusedValue");if(!n)return;const s=dn(r,{value:n,loopFocus:t("loopFocus")});I(()=>{t("composite")?s?.focus():s?.dataset.value!=null&&e.set("focusedValue",s.dataset.value)})},focusPrevTab({context:e,prop:t,scope:r,event:o}){const n=o.value??e.get("focusedValue");if(!n)return;const s=fn(r,{value:n,loopFocus:t("loopFocus")});I(()=>{t("composite")?s?.focus():s?.dataset.value!=null&&e.set("focusedValue",s.dataset.value)})},syncTabIndex({context:e,scope:t}){I(()=>{const r=e.get("value");if(!r)return;const o=cn(t,r);if(!o)return;Yr(o).length>0?o.removeAttribute("tabindex"):o.setAttribute("tabindex","0")})},cleanupObserver({refs:e}){const t=e.get("indicatorCleanup");t&&t()},setIndicatorRect({context:e,event:t,scope:r}){const o=t.id??e.get("value");!nt(r)||!o||!ae(r,o)||e.set("indicatorRect",pn(r,o))},syncSsr({context:e}){e.set("ssr",!1)},syncIndicatorRect({context:e,refs:t,scope:r}){const o=t.get("indicatorCleanup");if(o&&o(),!nt(r))return;const s=()=>{const f=ae(r,e.get("value"));if(!f)return;const l=vr(f);e.set("indicatorRect",u=>fo(u,l)?u:l)};s();const i=z(r),a=Zr(...i.map(f=>Xr.observe(f,s)));t.set("indicatorCleanup",a)},navigateIfNeeded({context:e,prop:t,scope:r}){const o=e.get("value");if(!o)return;const n=ae(r,o);Jr(n)&&t("navigate")?.({value:o,node:n,href:n.href})}}}});ge()(["activationMode","composite","deselectable","dir","getRootNode","id","ids","loopFocus","navigate","onFocusChange","onValueChange","orientation","translations","value","defaultValue"]);ge()(["disabled","value"]);ge()(["value"]);const Pn=e=>{const t=p.useId(),{getRootNode:r}=wt(),{dir:o}=Ge(),n={id:t,dir:o,getRootNode:r,...e},s=$e(gn,n);return hn(s,St)},yn=x(),br=p.forwardRef((e,t)=>{const[r,o]=Mt(e),[n,s]=yn(o,["activationMode","composite","defaultValue","deselectable","id","ids","loopFocus","navigate","onFocusChange","onValueChange","orientation","translations","value"]),i=Pn(n),a=g(i.getRootProps(),s);return c.jsx(hr,{value:i,children:c.jsx(jt,{value:r,children:c.jsx(P.div,{...a,ref:t})})})});br.displayName="TabsRoot";const Cn=x(),wr=p.forwardRef((e,t)=>{const[r,o]=Mt(e),[{value:n},s]=Cn(o,["value"]),i=g(n.getRootProps(),s);return c.jsx(hr,{value:n,children:c.jsx(jt,{value:r,children:c.jsx(P.div,{...i,ref:t})})})});wr.displayName="TabsRootProvider";const{withProvider:Sr,withContext:b}=kt({key:"colorPicker"});Sr(or,"root",{forwardAsChild:!0});const vn=Sr(rr,"root",{forwardAsChild:!0});b(er,"label",{forwardAsChild:!0});const bn=b(Qt,"control",{forwardAsChild:!0}),kr=b(dr,"swatch",{forwardAsChild:!0}),wn=b(ur,"trigger",{forwardAsChild:!0,defaultProps:{children:c.jsx(kr,{})}}),Sn=b(tr,"positioner",{forwardAsChild:!0}),kn=b(Kt,"content",{forwardAsChild:!0}),xn=b(Ut,"areaBackground",{forwardAsChild:!0}),_n=b(Bt,"areaThumb",{forwardAsChild:!0}),Rn=b(Lt,"area",{forwardAsChild:!0,defaultProps:{children:c.jsxs(c.Fragment,{children:[c.jsx(xn,{}),c.jsx(_n,{})]})}}),Tn=b(Wt,"channelSliderTrack",{forwardAsChild:!0}),En=b(qt,"channelSliderThumb",{forwardAsChild:!0}),Nn=b(lr,"transparencyGrid",{forwardAsChild:!0}),Fe=b($t,"channelSlider",{forwardAsChild:!0,defaultProps:{children:c.jsxs(c.Fragment,{children:[c.jsx(Nn,{size:"0.6rem"}),c.jsx(Tn,{}),c.jsx(En,{})]})}}),An=p.forwardRef(function(t,r){return c.jsxs(H,{gap:"1",flex:"1",px:"1",ref:r,...t,children:[c.jsx(Fe,{channel:"hue"}),c.jsx(Fe,{channel:"alpha"})]})}),xr=b(zt,"channelInput",{forwardAsChild:!0});p.forwardRef(function(t,r){return c.jsx(xr,{channel:"hex",ref:r,...t})});const In=b(ir,"swatchGroup",{forwardAsChild:!0}),Fn=b(cr,"swatchTrigger",{forwardAsChild:!0}),On=b(sr,"swatch",{forwardAsChild:!0}),jn=b(ar,"swatchIndicator",{forwardAsChild:!0});b(fr,"valueText",{forwardAsChild:!0});const Mn=b(pr,"view",{forwardAsChild:!0});b(Xt,"formatTrigger",{forwardAsChild:!0});const Vn=b(Zt,"formatSelect",{forwardAsChild:!0});b(Jt,"eyeDropperTrigger",{forwardAsChild:!0});const Dn=p.forwardRef(function(t,r){const{children:o=c.jsx(mo,{}),...n}=t,s=v(),i=go(s.getEyeDropperTriggerProps(),n);return c.jsx(Po,{ref:r,...i,children:o})});b(Ht,"channelSliderValueText",{forwardAsChild:!0});b(Gt,"channelSliderLabel",{forwardAsChild:!0});const Ln=p.forwardRef(function(t,r){return c.jsx(Yt,{tabIndex:-1,ref:r,...t})}),Un=b("span","channelText",{forwardAsChild:!0}),Bn={rgba:["red","green","blue","alpha"],hsla:["hue","saturation","lightness","alpha"],hsba:["hue","saturation","brightness","alpha"],hexa:["hex","alpha"]},zn=e=>Bn[e],_r=p.forwardRef(function(t,r){return c.jsx(H,{align:"center",...t,direction:"column",ref:r})});_r.displayName="VStack";const{withProvider:Rr,withContext:Y}=kt({key:"tabs"});Rr(wr,"root",{forwardAsChild:!0});const $n=Rr(br,"root",{forwardAsChild:!0}),st=Y(yr,"trigger",{forwardAsChild:!0}),it=Y(mr,"content",{forwardAsChild:!0});Y("div","contentGroup");const Gn=Y(Pr,"list",{forwardAsChild:!0}),ws=Y(gr,"indicator",{forwardAsChild:!0});var qn=class extends xt{#o;#e=void 0;#t;#n;constructor(e,t){super(),this.#o=e,this.setOptions(t),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#o.defaultMutationOptions(e),_t(this.options,t)||this.#o.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),t?.mutationKey&&this.options.mutationKey&&tt(t.mutationKey)!==tt(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#s(e)}getCurrentResult(){return this.#e}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#r(),this.#s()}mutate(e,t){return this.#n=t,this.#t?.removeObserver(this),this.#t=this.#o.getMutationCache().build(this.#o,this.options),this.#t.addObserver(this),this.#t.execute(e)}#r(){const e=this.#t?.state??yo();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#s(e){K.batch(()=>{if(this.#n&&this.hasListeners()){const t=this.#e.variables,r=this.#e.context,o={client:this.#o,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#n.onSuccess?.(e.data,t,r,o),this.#n.onSettled?.(e.data,null,t,r,o)):e?.type==="error"&&(this.#n.onError?.(e.error,t,r,o),this.#n.onSettled?.(void 0,e.error,t,r,o))}this.listeners.forEach(t=>{t(this.#e)})})}};function at(e,t){const r=new Set(t);return e.filter(o=>!r.has(o))}function Wn(e,t,r){const o=e.slice(0);return o[t]=r,o}var Hn=class extends xt{#o;#e;#t;#n;#r;#s;#i;#a;#c=[];constructor(e,t,r){super(),this.#o=e,this.#n=r,this.#t=[],this.#r=[],this.#e=[],this.setQueries(t)}onSubscribe(){this.listeners.size===1&&this.#r.forEach(e=>{e.subscribe(t=>{this.#f(e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#r.forEach(e=>{e.destroy()})}setQueries(e,t){this.#t=e,this.#n=t,K.batch(()=>{const r=this.#r,o=this.#d(this.#t);this.#c=o,o.forEach(u=>u.observer.setOptions(u.defaultedQueryOptions));const n=o.map(u=>u.observer),s=n.map(u=>u.getCurrentResult()),i=r.length!==n.length,a=n.some((u,m)=>u!==r[m]),f=i||a,l=f?!0:s.some((u,m)=>{const h=this.#e[m];return!h||!_t(u,h)});!f&&!l||(f&&(this.#r=n),this.#e=s,this.hasListeners()&&(f&&(at(r,n).forEach(u=>{u.destroy()}),at(n,r).forEach(u=>{u.subscribe(m=>{this.#f(u,m)})})),this.#p()))})}getCurrentResult(){return this.#e}getQueries(){return this.#r.map(e=>e.getCurrentQuery())}getObservers(){return this.#r}getOptimisticResult(e,t){const r=this.#d(e),o=r.map(n=>n.observer.getOptimisticResult(n.defaultedQueryOptions));return[o,n=>this.#u(n??o,t),()=>this.#l(o,r)]}#l(e,t){return t.map((r,o)=>{const n=e[o];return r.defaultedQueryOptions.notifyOnChangeProps?n:r.observer.trackResult(n,s=>{t.forEach(i=>{i.observer.trackProp(s)})})})}#u(e,t){return t?((!this.#s||this.#e!==this.#a||t!==this.#i)&&(this.#i=t,this.#a=this.#e,this.#s=Co(this.#s,t(e))),this.#s):e}#d(e){const t=new Map;this.#r.forEach(o=>{const n=o.options.queryHash;if(!n)return;const s=t.get(n);s?s.push(o):t.set(n,[o])});const r=[];return e.forEach(o=>{const n=this.#o.defaultQueryOptions(o),i=t.get(n.queryHash)?.shift()??new Nt(this.#o,n);r.push({defaultedQueryOptions:n,observer:i})}),r}#f(e,t){const r=this.#r.indexOf(e);r!==-1&&(this.#e=Wn(this.#e,r,t),this.#p())}#p(){if(this.hasListeners()){const e=this.#s,t=this.#l(this.#e,this.#c),r=this.#u(t,this.#n?.combine);e!==r&&K.batch(()=>{this.listeners.forEach(o=>{o(this.#e)})})}}};function Ke({queries:e,...t},r){const o=Rt(),n=_o(),s=Ro(),i=p.useMemo(()=>e.map(C=>{const w=o.defaultQueryOptions(C);return w._optimisticResults=n?"isRestoring":"optimistic",w}),[e,o,n]);i.forEach(C=>{To(C),Eo(C,s)}),No(s);const[a]=p.useState(()=>new Hn(o,i,t)),[f,l,u]=a.getOptimisticResult(i,t.combine),m=!n&&t.subscribed!==!1;p.useSyncExternalStore(p.useCallback(C=>m?a.subscribe(K.batchCalls(C)):Tt,[a,m]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),p.useEffect(()=>{a.setQueries(i,t)},[i,t,a]);const d=f.some((C,w)=>rt(i[w],C))?f.flatMap((C,w)=>{const S=i[w];if(S){const $=new Nt(o,S);if(rt(S,C))return ot(S,$,s);Ao(C,n)&&ot(S,$,s)}return[]}):[];if(d.length>0)throw Promise.all(d);const y=f.find((C,w)=>{const S=i[w];return S&&Io({result:C,errorResetBoundary:s,throwOnError:S.throwOnError,query:o.getQueryCache().get(S.queryHash),suspense:S.suspense})});if(y?.error)throw y.error;return l(u())}function Tr(e,t){const r=Rt(),[o]=p.useState(()=>new qn(r,e));p.useEffect(()=>{o.setOptions(e)},[o,e]);const n=p.useSyncExternalStore(p.useCallback(i=>o.subscribe(K.batchCalls(i)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),s=p.useCallback((i,a)=>{o.mutate(i,a).catch(Tt)},[o]);if(n.error&&vo(o.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:s,mutateAsync:n.mutate}}function se(e){return e*Math.PI/180}function Kn(e){let t=((e+180)%360+360)%360-180;return t===-180&&(t=180),t}function Er(e){return(e%360+360)%360}function Ce(e,t,r){return Math.max(t,Math.min(r,e))}function Ss(e,t,r,o){const n=se(e),s=se(t),i=se(r),a=se(o),f=Math.cos(n)*Math.cos(s),l=Math.sin(s),u=Math.sin(n)*Math.cos(s),m=Math.cos(i),h=Math.sin(i),d=m*f+h*u,y=-h*f+m*u,C=l,w=Math.cos(a),S=Math.sin(a),$=w*C-S*y,et=S*C+w*y;return{x:d,y:$,z:et,visible:et>0}}function ks(e,t,r,o,n){return{x:t-e.x*o*n,y:r-e.y*o*n}}function xs(e,t){const r=Er(e+90),o=Ce(t,-90,90);return{ra:r,dec:o}}function _s(e,t){const r=Kn(e-90),o=Ce(t,-90,90);return{yawDeg:r,pitchDeg:o}}const N=X()((e,t)=>({footprints:[],view:{yawDeg:0,pitchDeg:0,scale:1},globeBackground:{centerX:200,centerY:200,initialRadius:200},globeGrid:{showGrid:!0,meridianStep:90,parallelStep:30},hoveredFootprintId:null,hoveredFootprintMousePosition:null,selectedFootprintId:null,setView:r=>e(o=>{let n=r.yawDeg??o.view.yawDeg;n=Er(n);let s=r.pitchDeg??o.view.pitchDeg;return s=Ce(s,-90,90),{view:{...o.view,...r,yawDeg:n,pitchDeg:s}}}),setGlobeBackground:r=>e({globeBackground:r}),setGlobeGrid:r=>e(o=>({globeGrid:{...o.globeGrid,...r}})),setFootprints:r=>e({footprints:r}),setHoveredFootprintId:r=>e({hoveredFootprintId:r}),setHoveredFootprintMousePosition:r=>e({hoveredFootprintMousePosition:r}),setSelectedFootprintId:r=>e({selectedFootprintId:r}),setFootprintMeta:(r,o,n)=>e(s=>({footprints:s.footprints.map(i=>i.id===r?{...i,meta:{...i.meta||{},[o]:n}}:i)})),getBasenameList:r=>t().footprints.find(n=>n.id===r)?.meta?.included_files??[],getSelectedBasenameList:()=>{const r=t().selectedFootprintId;return r?t().footprints.find(n=>n.id===r)?.meta?.included_files??[]:[]}})),k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));function Qn(e,t=0){return(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase()}let _e;const Jn=new Uint8Array(16);function Zn(){if(!_e){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");_e=crypto.getRandomValues.bind(crypto)}return _e(Jn)}const Xn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ct={randomUUID:Xn};function Yn(e,t,r){e=e||{};const o=e.random??e.rng?.()??Zn();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,Qn(o)}function Nr(e,t,r){return ct.randomUUID&&!e?ct.randomUUID():Yn(e)}const lt="#eb5e41",Re=e=>{const t=zn(e.format);return c.jsx(Mn,{format:e.format,children:c.jsx(Oo,{each:t,children:r=>c.jsxs(H,{gap:"1",children:[c.jsx(Un,{minW:"5ch",children:r}),c.jsx(Fe,{channel:r})]},r)})})},Rs=e=>{const{value:t,onValueChange:r}=e;return c.jsxs(vn,{value:bo(t),onValueChange:o=>{r(o.value.toString("hex"))},maxW:"200px",children:[c.jsx(Ln,{}),c.jsx(bn,{children:c.jsx(wn,{"data-fit-content":!0,px:"1.5",py:"1",children:c.jsx(kr,{boxSize:"6",rounded:"inherit"})})}),c.jsx(wo,{children:c.jsx(Sn,{children:c.jsxs(kn,{children:[c.jsxs($n,{defaultValue:"picker",size:"sm",variant:"line",children:[c.jsxs(Gn,{mb:"3",children:[c.jsx(st,{value:"picker",children:"picker"}),c.jsx(st,{value:"channels",children:"channels"})]}),c.jsx(it,{value:"picker",children:c.jsxs(H,{gap:"3",children:[c.jsx(Rn,{}),c.jsxs(So,{children:[c.jsx(Dn,{size:"xs",variant:"outline"}),c.jsx(An,{})]})]})}),c.jsx(it,{value:"channels",children:c.jsxs(H,{gap:"3",children:[c.jsx(Vn,{}),c.jsx(Re,{format:"hsla"}),c.jsx(Re,{format:"hsba"}),c.jsx(Re,{format:"rgba"})]})})]}),c.jsxs(_r,{mt:"4",align:"stretch",gap:"3",children:[c.jsx(In,{children:es.map(o=>c.jsx(Fn,{value:o,children:c.jsx(On,{boxSize:"4.5",value:o,children:c.jsx(jn,{children:c.jsx(ko,{})})})},o))}),c.jsx(xr,{channel:"hex","aria-label":"Hex color"})]})]})})})]})},es=["#000000","#4A5568","#F56565","#ED64A6","#9F7AEA","#6B46C1","#4299E1","#0BC5EA","#00B5D8","#38B2AC","#48BB78","#68D391","#ECC94B","#DD6B20"];function ut(e){return`hsl(${e*137.508%360}, 85%, 60%)`}function de(e){const t=Math.min(e.min,e.max),r=Math.max(e.min,e.max);return{min:t,max:r}}function dt(e,t){return new RegExp(`^${t} \\d+$`).test(e)}function Te(e){const t=e.filter(a=>a.kind==="linear"),r=e.filter(a=>a.kind==="gaussian");let o=1,n=1,s=1;const i=[];for(const a of t){const f=o++,l=n++,u=dt(a.name,"Linear")?`Linear ${l}`:a.name;i.push({...a,id:f,name:u,kind:"linear",range:de(a.range)})}for(const a of r){const f=o++,l=s++,u=dt(a.name,"Gaussian")?`Gaussian ${l}`:a.name;i.push({...a,id:f,name:u,kind:"gaussian",range:de(a.range)})}return i}function ft(e,t,r,o){return e.map(n=>{if(n.id!==t)return n;let s=!1;if(n.kind==="linear"?s=["k","b"].includes(r):n.kind==="gaussian"&&(s=["amplitude","mu","sigma"].includes(r)),!s)return n;let a={...n.priors||{}};return o===void 0?delete a[r]:a[r]=o,Object.keys(a).length===0&&(a=void 0),{...n,priors:a}})}function Ts(e,t){switch(e.kind){case"linear":switch(t){case"k":return e.k;case"b":return e.b;default:return}case"gaussian":switch(t){case"amplitude":return e.amplitude;case"mu":return e.mu;case"sigma":return e.sigma;default:return}default:return}}const Oe=X()(At((e,t)=>({waveFrame:"observe",models:[],configurations:[],jobs:[],fitExtraction:{apertureSize:5,extractMode:"GRISMR"},setWaveFrame:r=>e({waveFrame:r}),setFitExtraction:r=>e(o=>({fitExtraction:{...o.fitExtraction,...r}})),ensureInitialModels:r=>{const o=t();o.models.length>0||(o.addLinearModel(r),o.addGaussianModel(r))},duplicateNameIds:()=>{const r=t().models,o={};r.forEach(s=>{o[s.name]=(o[s.name]||0)+1});const n=[];return r.forEach(s=>{o[s.name]>1&&n.push(s.id)}),n},updateModelPrior:(r,o,n)=>e(s=>({models:ft(s.models,r,o,n)})),updateConfigurationModelPrior:(r,o,n,s)=>e(i=>({configurations:i.configurations.map(a=>a.id!==r?a:{...a,models:ft(a.models,o,n,s)})})),addLinearModel:r=>e(o=>{const n=de(r),i={id:0,kind:"linear",name:"Linear 1",active:!0,subtracted:!1,k:0,b:0,x0:.5*(n.min+n.max),range:n,color:lt},a=[...o.models,i];return{models:Te(a)}}),addGaussianModel:r=>e(o=>{const n=de(r),i={id:0,kind:"gaussian",name:"Gaussian 1",active:!0,subtracted:!1,amplitude:0,mu:.5*(n.min+n.max),sigma:5e-4,range:n,color:lt},a=[...o.models,i];return{models:Te(a)}}),addModel:(r,o)=>{r==="linear"?t().addLinearModel(o):t().addGaussianModel(o)},updateModel:(r,o)=>e(n=>({models:n.models.map(s=>s.id!==r?s:s.kind==="linear"?{...s,...o,kind:"linear"}:{...s,...o,kind:"gaussian"})})),removeModel:r=>e(o=>{const n=o.models.filter(s=>s.id!==r);return{models:Te(n)}}),renameModel:(r,o)=>e(n=>({models:n.models.map(s=>s.id===r?{...s,name:o}:s)})),validateModel:()=>{e(r=>({models:r.models.map(o=>{if(o.kind==="gaussian"){const n=Math.abs(o.sigma);return{...o,sigma:n}}return o})}))},toggleActive:(r,o)=>e(n=>({models:n.models.map(s=>s.id===r?{...s,active:o}:s)})),filterModel:r=>t().models.filter(r),filterGaussianModel:()=>t().models.filter(r=>r.kind==="gaussian"),filterLinearModel:()=>t().models.filter(r=>r.kind==="linear"),filterActivatedModel:()=>t().models.filter(r=>r.active),saveCurrentConfiguration:()=>e(r=>{const o=JSON.parse(JSON.stringify(r.models)),n={id:Nr(),name:`Config ${r.configurations.length+1}`,models:o,selected:!0};return{configurations:[...r.configurations,n]}}),removeConfiguration:r=>e(o=>({configurations:o.configurations.filter(n=>n.id!==r)})),toggleConfigurationSelection:r=>e(o=>({configurations:o.configurations.map(n=>n.id===r?{...n,selected:!n.selected}:n)})),loadConfigurationToDraft:r=>e(o=>{const n=o.configurations.find(i=>i.id===r);return n?{models:JSON.parse(JSON.stringify(n.models))}:{}}),getSelectedConfiguration:()=>t().configurations.filter(r=>r.selected),setConfigurationName:(r,o)=>e(n=>({configurations:n.configurations.map(s=>s.id===r?{...s,name:o}:s)})),addJob:r=>e(o=>({jobs:[...o.jobs,r]})),removeJob:r=>e(o=>({jobs:o.jobs.filter(n=>n.job_id!==r)})),updateJob:r=>e(o=>({jobs:o.jobs.map(n=>n.job_id===r.job_id?r:n)}))}),{name:"noobrowser-fit-store",partialize:e=>({configurations:e.configurations,jobs:e.jobs})})),pt=X()(e=>({availableFilters:[],filterRGB:{r:"",g:"",b:""},displayMode:"rgb",opacity:1,counterpartNorm:{pmin:1,pmax:99},counterpartPosition:{x0:0,y0:0,width:3e3,height:0},cutoutParams:{cutoutPmin:1,cutoutPmax:99,x0:0,y0:0,width:100,height:100},cutoutNorm:{pmin:1,pmax:99},cutoutSortedArray:null,showCutout:!0,goToCutoutRequested:!1,setAvailableFilters:t=>e({availableFilters:t}),setFilterRGB:t=>e(r=>({filterRGB:{...r.filterRGB,...t}})),setDisplayMode:t=>e({displayMode:t}),setOpacity:t=>{const r=Ce(t,0,1);e({opacity:r})},setCounterpartNorm:t=>e(r=>({counterpartNorm:{...r.counterpartNorm,...t}})),setCounterpartPosition:t=>e(r=>({counterpartPosition:{...r.counterpartPosition,...t}})),setCutoutParams:t=>e(r=>({cutoutParams:{...r.cutoutParams,...t}})),setCutoutNorm:t=>e(r=>({cutoutNorm:{...r.cutoutNorm,...t}})),setCutoutSortedArray:t=>e({cutoutSortedArray:t}),setShowCutout:t=>e({showCutout:t}),setGoToCutoutRequested:t=>e({goToCutoutRequested:t})})),Es=X()(At(e=>({waveUnit:"µm",apertureSize:100,zRedshift:0,grismNorm:{pmin:1,pmax:99},extractedSpecSortedArray:null,normInWindow:!1,forwardSourcePosition:{x:0,y:0},spectrumQueryKey:null,forwardWaveRange:{min:3.8,max:5},slice1DWaveRange:{min:3.8,max:5},collapseWindow:{waveMin:3.8,waveMax:5,spatialMin:0,spatialMax:100},emissionLines:{"H⍺":.6563,Hβ:.4861,"[OIII]λ4959":.4959,"[OIII]λ5007":.5007,Paβ:1.2818},selectedEmissionLines:{},showTraceOnSpectrum2D:!0,backwardGlobalNorm:{pmin:1,pmax:99},backwardRoiNorm:{pmin:1,pmax:99},backwardNormIndependent:!1,roiState:{x:0,y:0,width:256,height:128},roiCollapseWindow:{waveMin:0,waveMax:256,spatialMin:128/2-5,spatialMax:128/2+5},counterpartVisible:!0,setWaveUnit:t=>e({waveUnit:t}),setApertureSize:t=>e({apertureSize:t}),setZRedshift:t=>e({zRedshift:t}),setGrismNorm:t=>e(r=>({grismNorm:{...r.grismNorm,...t}})),setExtractedSpecSortedArray:t=>e({extractedSpecSortedArray:t}),setNormInWindow:t=>e({normInWindow:t}),setForwardSourcePosition:t=>e({forwardSourcePosition:t}),setSpectrumQueryKey:t=>e({spectrumQueryKey:t}),setForwardWaveRange:t=>e(r=>({forwardWaveRange:{...r.forwardWaveRange,...t}})),setSlice1DWaveRange:t=>e(r=>({slice1DWaveRange:{...r.slice1DWaveRange,...t}})),setCollapseWindow:t=>e(r=>({collapseWindow:{...r.collapseWindow,...t}})),setEmissionLines:t=>{const r=Object.fromEntries(Object.entries(t).sort((o,n)=>o[1]-n[1]));e({emissionLines:r})},addEmissionLine:(t,r)=>{e(o=>{const n={...o.emissionLines,[t]:r};return{emissionLines:Object.fromEntries(Object.entries(n).sort((i,a)=>i[1]-a[1]))}})},removeEmissionLine:t=>{e(r=>{const o={...r.emissionLines};delete o[t];const{[t]:n,...s}=r.selectedEmissionLines;return{emissionLines:o,selectedEmissionLines:s}})},setSelectedEmissionLines:t=>e({selectedEmissionLines:t}),switchShowTraceOnSpectrum2D:()=>e(t=>({showTraceOnSpectrum2D:!t.showTraceOnSpectrum2D})),setBackwardGlobalNorm:t=>e(r=>({backwardGlobalNorm:{...r.backwardGlobalNorm,...t}})),setBackwardRoiNorm:t=>e(r=>({backwardRoiNorm:{...r.backwardRoiNorm,...t}})),setBackwardNormIndependent:t=>e({backwardNormIndependent:t}),syncBackwardNorms:()=>e(t=>({backwardRoiNorm:{...t.backwardGlobalNorm}})),setRoiState:t=>e(r=>({roiState:{...r.roiState,...t}})),setRoiCollapseWindow:t=>e(r=>({roiCollapseWindow:{...r.roiCollapseWindow,...t}})),setCounterpartVisible:t=>e({counterpartVisible:t})}),{name:"emission-lines-storage",storage:Fo(()=>localStorage),partialize:e=>({emissionLines:e.emissionLines,selectedEmissionLines:e.selectedEmissionLines})}));var Ar=Symbol.for("immer-nothing"),ht=Symbol.for("immer-draftable"),_=Symbol.for("immer-state");function T(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var R=Object,U=R.getPrototypeOf,fe="constructor",ve="prototype",je="configurable",pe="enumerable",ce="writable",Q="value",O=e=>!!e&&!!e[_];function j(e){return e?Ir(e)||be(e)||!!e[ht]||!!e[fe]?.[ht]||we(e)||Se(e):!1}var ts=R[ve][fe].toString(),mt=new WeakMap;function Ir(e){if(!e||!Qe(e))return!1;const t=U(e);if(t===null||t===R[ve])return!0;const r=R.hasOwnProperty.call(t,fe)&&t[fe];if(r===Object)return!0;if(!L(r))return!1;let o=mt.get(r);return o===void 0&&(o=Function.toString.call(r),mt.set(r,o)),o===ts}function ee(e,t,r=!0){te(e)===0?(r?Reflect.ownKeys(e):R.keys(e)).forEach(n=>{t(n,e[n],e)}):e.forEach((o,n)=>t(n,o,e))}function te(e){const t=e[_];return t?t.type_:be(e)?1:we(e)?2:Se(e)?3:0}var gt=(e,t,r=te(e))=>r===2?e.has(t):R[ve].hasOwnProperty.call(e,t),Me=(e,t,r=te(e))=>r===2?e.get(t):e[t],he=(e,t,r,o=te(e))=>{o===2?e.set(t,r):o===3?e.add(r):e[t]=r};function rs(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var be=Array.isArray,we=e=>e instanceof Map,Se=e=>e instanceof Set,Qe=e=>typeof e=="object",L=e=>typeof e=="function",Ee=e=>typeof e=="boolean",A=e=>e.copy_||e.base_,Je=e=>e.modified_?e.copy_:e.base_;function Ve(e,t){if(we(e))return new Map(e);if(Se(e))return new Set(e);if(be(e))return Array[ve].slice.call(e);const r=Ir(e);if(t===!0||t==="class_only"&&!r){const o=R.getOwnPropertyDescriptors(e);delete o[_];let n=Reflect.ownKeys(o);for(let s=0;s<n.length;s++){const i=n[s],a=o[i];a[ce]===!1&&(a[ce]=!0,a[je]=!0),(a.get||a.set)&&(o[i]={[je]:!0,[ce]:!0,[pe]:a[pe],[Q]:e[i]})}return R.create(U(e),o)}else{const o=U(e);if(o!==null&&r)return{...e};const n=R.create(o);return R.assign(n,e)}}function Ze(e,t=!1){return ke(e)||O(e)||(te(e)>1&&R.defineProperties(e,{set:ie,add:ie,clear:ie,delete:ie}),R.freeze(e),t&&ee(e,(r,o)=>{Ze(o,!0)},!1)),e}function os(){T(2)}var ie={[Q]:os};function ke(e){return e===null||!Qe(e)?!0:R.isFrozen(e)}var me="MapSet",De="Patches",Fr={};function B(e){const t=Fr[e];return t||T(0,e),t}var ns=e=>!!Fr[e],J,Or=()=>J,ss=(e,t)=>({drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:ns(me)?B(me):void 0});function Pt(e,t){t&&(e.patchPlugin_=B(De),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Le(e){Ue(e),e.drafts_.forEach(is),e.drafts_=null}function Ue(e){e===J&&(J=e.parent_)}var yt=e=>J=ss(J,e);function is(e){const t=e[_];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Ct(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];if(e!==void 0&&e!==r){r[_].modified_&&(Le(t),T(4)),j(e)&&(e=vt(t,e));const{patchPlugin_:n}=t;n&&n.generateReplacementPatches_(r[_].base_,e,t)}else e=vt(t,r);return as(t,e,!0),Le(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Ar?e:void 0}function vt(e,t){if(ke(t))return t;const r=t[_];if(!r)return Xe(t,e.handledSet_,e);if(!xe(r,e))return t;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:o}=r;if(o)for(;o.length>0;)o.pop()(e);Vr(r,e)}return r.copy_}function as(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Ze(t,r)}function jr(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var xe=(e,t)=>e.scope_===t,cs=[];function Mr(e,t,r,o){const n=A(e),s=e.type_;if(o!==void 0&&Me(n,o,s)===t){he(n,o,r,s);return}if(!e.draftLocations_){const a=e.draftLocations_=new Map;ee(n,(f,l)=>{if(O(l)){const u=a.get(l)||[];u.push(f),a.set(l,u)}})}const i=e.draftLocations_.get(t)??cs;for(const a of i)he(n,a,r,s)}function ls(e,t,r){e.callbacks_.push(function(n){const s=t;if(!s||!xe(s,n))return;n.mapSetPlugin_?.fixSetContents(s);const i=Je(s);Mr(e,s.draft_??s,i,r),Vr(s,n)})}function Vr(e,t){if(e.modified_&&!e.finalized_&&(e.type_===3||(e.assigned_?.size??0)>0)){const{patchPlugin_:o}=t;if(o){const n=o.getPath(e);n&&o.generatePatches_(e,n,t)}jr(e)}}function us(e,t,r){const{scope_:o}=e;if(O(r)){const n=r[_];xe(n,o)&&n.callbacks_.push(function(){le(e);const i=Je(n);Mr(e,r,i,t)})}else j(r)&&e.callbacks_.push(function(){const s=A(e);Me(s,t,e.type_)===r&&o.drafts_.length>1&&(e.assigned_.get(t)??!1)===!0&&e.copy_&&Xe(Me(e.copy_,t,e.type_),o.handledSet_,o)})}function Xe(e,t,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||O(e)||t.has(e)||!j(e)||ke(e)||(t.add(e),ee(e,(o,n)=>{if(O(n)){const s=n[_];if(xe(s,r)){const i=Je(s);he(e,o,i,e.type_),jr(s)}}else j(n)&&Xe(n,t,r)})),e}function ds(e,t){const r=be(e),o={type_:r?1:0,scope_:t?t.scope_:Or(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let n=o,s=Ye;r&&(n=[o],s=Z);const{revoke:i,proxy:a}=Proxy.revocable(n,s);return o.draft_=a,o.revoke_=i,[a,o]}var Ye={get(e,t){if(t===_)return e;const r=A(e);if(!gt(r,t,e.type_))return fs(e,r,t);const o=r[t];if(e.finalized_||!j(o))return o;if(o===Ne(e.base_,t)){le(e);const n=e.type_===1?+t:t,s=ze(e.scope_,o,e,n);return e.copy_[n]=s}return o},has(e,t){return t in A(e)},ownKeys(e){return Reflect.ownKeys(A(e))},set(e,t,r){const o=Dr(A(e),t);if(o?.set)return o.set.call(e.draft_,r),!0;if(!e.modified_){const n=Ne(A(e),t),s=n?.[_];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_.set(t,!1),!0;if(rs(r,n)&&(r!==void 0||gt(e.base_,t,e.type_)))return!0;le(e),Be(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_.set(t,!0),us(e,t,r)),!0},deleteProperty(e,t){return le(e),Ne(e.base_,t)!==void 0||t in e.base_?(e.assigned_.set(t,!1),Be(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=A(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o&&{[ce]:!0,[je]:e.type_!==1||t!=="length",[pe]:o[pe],[Q]:r[t]}},defineProperty(){T(11)},getPrototypeOf(e){return U(e.base_)},setPrototypeOf(){T(12)}},Z={};ee(Ye,(e,t)=>{Z[e]=function(){const r=arguments;return r[0]=r[0][0],t.apply(this,r)}});Z.deleteProperty=function(e,t){return Z.set.call(this,e,t,void 0)};Z.set=function(e,t,r){return Ye.set.call(this,e[0],t,r,e[0])};function Ne(e,t){const r=e[_];return(r?A(r):e)[t]}function fs(e,t,r){const o=Dr(t,r);return o?Q in o?o[Q]:o.get?.call(e.draft_):void 0}function Dr(e,t){if(!(t in e))return;let r=U(e);for(;r;){const o=Object.getOwnPropertyDescriptor(r,t);if(o)return o;r=U(r)}}function Be(e){e.modified_||(e.modified_=!0,e.parent_&&Be(e.parent_))}function le(e){e.copy_||(e.assigned_=new Map,e.copy_=Ve(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var ps=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(t,r,o)=>{if(L(t)&&!L(r)){const s=r;r=t;const i=this;return function(f=s,...l){return i.produce(f,u=>r.call(this,u,...l))}}L(r)||T(6),o!==void 0&&!L(o)&&T(7);let n;if(j(t)){const s=yt(this),i=ze(s,t,void 0);let a=!0;try{n=r(i),a=!1}finally{a?Le(s):Ue(s)}return Pt(s,o),Ct(n,s)}else if(!t||!Qe(t)){if(n=r(t),n===void 0&&(n=t),n===Ar&&(n=void 0),this.autoFreeze_&&Ze(n,!0),o){const s=[],i=[];B(De).generateReplacementPatches_(t,n,{patches_:s,inversePatches_:i}),o(s,i)}return n}else T(1,t)},this.produceWithPatches=(t,r)=>{if(L(t))return(i,...a)=>this.produceWithPatches(i,f=>t(f,...a));let o,n;return[this.produce(t,r,(i,a)=>{o=i,n=a}),o,n]},Ee(e?.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),Ee(e?.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),Ee(e?.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){j(e)||T(8),O(e)&&(e=hs(e));const t=yt(this),r=ze(t,e,void 0);return r[_].isManual_=!0,Ue(t),r}finishDraft(e,t){const r=e&&e[_];(!r||!r.isManual_)&&T(9);const{scope_:o}=r;return Pt(o,t),Ct(void 0,o)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const n=t[r];if(n.path.length===0&&n.op==="replace"){e=n.value;break}}r>-1&&(t=t.slice(r+1));const o=B(De).applyPatches_;return O(e)?o(e,t):this.produce(e,n=>o(n,t))}};function ze(e,t,r,o){const[n,s]=we(t)?B(me).proxyMap_(t,r):Se(t)?B(me).proxySet_(t,r):ds(t,r);return(r?.scope_??Or()).drafts_.push(n),s.callbacks_=r?.callbacks_??[],s.key_=o,r&&o!==void 0?ls(r,s,o):s.callbacks_.push(function(f){f.mapSetPlugin_?.fixSetContents(s);const{patchPlugin_:l}=f;s.modified_&&l&&l.generatePatches_(s,[],f)}),n}function hs(e){return O(e)||T(10,e),Lr(e)}function Lr(e){if(!j(e)||ke(e))return e;const t=e[_];let r,o=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=Ve(e,t.scope_.immer_.useStrictShallowCopy_),o=t.scope_.immer_.shouldUseStrictIteration()}else r=Ve(e,!0);return ee(r,(n,s)=>{he(r,n,Lr(s))},o),t&&(t.finalized_=!1),r}var ms=new ps,q=ms.produce;const gs=X()((e,t)=>({traceMode:!1,traceSources:[],mainTraceSourceId:null,displayedTraceSourceId:null,setTraceMode:r=>e({traceMode:r}),addTraceSource:(r,o,n,s)=>e(q(i=>{const a={id:Nr(),x:r,y:o,groupId:n,color:ut(i.traceSources.length),spectrumReady:!1,roi:{roiState:{...s.roiState},collapseWindow:{...s.collapseWindow}}};i.traceSources.push(a),i.mainTraceSourceId=a.id})),updateTraceSource:(r,o)=>e(q(n=>{const s=n.traceSources.find(i=>i.id===r);s&&Object.assign(s,o)})),updateMainTraceSource:r=>{const o=t().mainTraceSourceId;o&&t().updateTraceSource(o,r)},setMainTraceSource:r=>e({mainTraceSourceId:r}),setDisplayedTraceSource:r=>e({displayedTraceSourceId:r}),removeTraceSource:r=>e(q(o=>{o.traceSources=o.traceSources.filter(n=>n.id!==r),o.mainTraceSourceId===r&&(o.mainTraceSourceId=o.traceSources.length>0?o.traceSources[0].id:null),t().reassignTraceSourceColor()})),reassignTraceSourceColor:()=>e(q(r=>{r.traceSources.forEach((o,n)=>{o.color=ut(n)})})),clearTraceSources:()=>e({traceSources:[],mainTraceSourceId:null}),applyRoiToAllTraceSources:r=>e(q(o=>{o.traceSources.forEach(n=>{n.roi={roiState:{...r.roiState},collapseWindow:{...r.collapseWindow}}})}))}));function re(e){const{queryKey:t,path:r,axiosGetParams:o={},returnType:n="data",queryOptions:s={},checkParamsNull:i=!0}=e,a=F(h=>h.isConnected);let f=(e.enabled??!0)&&a;if(o?.params&&i){const h=Object.values(o.params).some(d=>d==null);f=f&&!h}const l=F(h=>h.backendUrl);return It({queryKey:t,enabled:f,queryFn:async()=>{if(n==="response")return E.get(l+r,o);if(n==="data")return E.get(l+r,o).then(h=>h.data);throw new Error(`Invalid returnType: ${n}`)},...s})}function Ns({selectedFootprintId:e=null,enabled:t=!1}){const r=N(s=>s.selectedFootprintId),o=e??r;return re({queryKey:["counterpart_footprint",o],path:`/image/counterpart_footprint/${o}`,enabled:t})}function As({selectedFootprintId:e=null,r:t=null,g:r=null,b:o=null,normParams:n,enabled:s=!1}){const i=N(d=>d.selectedFootprintId),a=pt(d=>d.filterRGB),f=pt(d=>d.counterpartNorm),l=n??f,u=e??i,m={r:t??a.r,g:r??a.g,b:o??a.b};return re({queryKey:["counterpart_image",u,m,l],path:`/image/counterpart_image/${u}`,axiosGetParams:{params:{...m,...l},responseType:"blob"},enabled:s,queryOptions:{gcTime:1e3*60}})}function Is({selectedFootprintId:e=null,basenameList:t=[],enabled:r=!1}){const o=N(l=>l.selectedFootprintId),n=e??o,s=N(l=>l.footprints),i=F(l=>l.backendUrl);let a;return!t||t.length===0?n?a=s.find(u=>u.id===n)?.meta?.included_files??[]:a=[]:a=t,Ke({queries:a.map(l=>({queryKey:["grism_offset",l,n],enabled:r&&!!n,queryFn:async()=>(await E.get(`${i}/wfss/grism_offset/${n}`,{params:{basename:l}})).data})),combine:l=>l.reduce((u,m,h)=>{const d=a[h];return u[d]=m,u},{})})}function Fs({selectedFootprintId:e=null,basenameList:t=[],enabled:r=!1}){const o=N(l=>l.footprints),n=N(l=>l.selectedFootprintId),s=e??n;let i;!t||t.length===0?s?i=o.find(u=>u.id===s)?.meta?.included_files??[]:i=[]:i=t;const a=F(l=>l.backendUrl);return Ke({queries:i.map(l=>({queryKey:["grism_data",l],enabled:r&&i.length>0,queryFn:async()=>{const u=await E.get(`${a}/wfss/grism_data/`,{params:{basename:l},responseType:"arraybuffer"}),m=u.data,h=u.headers,d=Number(h["x-data-height"]),y=Number(h["x-data-width"]);return{buffer:m,width:y,height:d}}})),combine:l=>l.reduce((u,m,h)=>{const d=i[h];return u[d]=m,u},{})})}function Os({selectedFootprintId:e=null,basenameList:t=[],enabled:r=!1}){const o=N(l=>l.footprints),n=N(l=>l.selectedFootprintId),s=e??n;let i;!t||t.length===0?s?i=o.find(u=>u.id===s)?.meta?.included_files??[]:i=[]:i=t;const a=F(l=>l.backendUrl);return Ke({queries:i.map(l=>({queryKey:["grism_err",l],enabled:r&&i.length>0,queryFn:async()=>{const u=await E.get(`${a}/wfss/grism_err/`,{params:{basename:l},responseType:"arraybuffer"}),m=u.data,h=u.headers,d=Number(h["x-data-height"]),y=Number(h["x-data-width"]);return{buffer:m,width:y,height:d}}})),combine:l=>l.reduce((u,m,h)=>{const d=i[h];return u[d]=m,u},{})})}function js({selectedFootprintId:e=null,q:t=[],roi:r=null,enabled:o=!1}){const n=N(f=>f.selectedFootprintId),s=e??n,i={};return t.length>0&&(i.percentage=t),r!==null&&(i.roi_x=r.x,i.roi_y=r.y,i.roi_width=r.width,i.roi_height=r.height),re({queryKey:["percentile_flux",s,{q:t,roi:r}],path:`/wfss/percentile_flux/${s}`,axiosGetParams:{params:i,paramsSerializer:{indexes:null}},enabled:o&&s!==null,queryOptions:{gcTime:1e3}})}function Ms({selectedFootprintId:e,basename:t,x:r,y:o,waveMin:n,waveMax:s,enabled:i=!1}){const a=N(m=>m.selectedFootprintId),f=e??a,l={...f!==null?{group_id:f}:{},...t!==void 0?{basename:t}:{},...r!==void 0?{x:r}:{},...o!==void 0?{y:o}:{},...n!==void 0?{wavemin:n}:{},...s!==void 0?{wavemax:s}:{}};return re({queryKey:["dispersion_trace",f,t,r,o,n,s],path:"/source/dispersion_trace/",enabled:i&&(!!f||!!t),axiosGetParams:{params:l},queryOptions:{gcTime:1e3*10}})}function Vs(){const e=F(o=>o.backendUrl),t=gs(o=>o.traceSources),r=Oe(o=>o.configurations);return Tr({mutationFn:async o=>{const{sourceId:n,sourceMeta:s,extractionConfig:i,fitConfigs:a}=o,f=i??{aperture_size:5,extraction_mode:"GRISMR"},l=a??r.filter(h=>h.selected).map(h=>({model_name:h.name,models:h.models}));if(l.length===0)throw new Error("No fit configurations selected. Please select at least one configuration.");let u;if(s)u=s;else{const h=t.find(d=>d.id===n);if(!h)throw new Error(`Trace source with ID ${n} not found.`);u={source_id:h.id,ra:h.ra,dec:h.dec,x:h.x,y:h.y,group_id:h.groupId,z:h.z}}const m={extraction:{extraction_config:f,source_meta:u},fit:l};try{return(await E.post(`${e}/fit/submit/`,m)).data}catch(h){if(E.isAxiosError(h)&&h.response){const d=h.response.data;let y="Unknown error";throw d?.detail?Array.isArray(d.detail)?y=d.detail.map(w=>`${w.loc.join(".")} -> ${w.msg}`).join(`
`):typeof d.detail=="object"?y=JSON.stringify(d.detail):y=String(d.detail):d?.message?y=d.message:y=h.message,new Error(`Fit job submission failed:
${y}`)}throw h}},onSuccess:(o,n)=>{ue.success({title:"Fit Job Submitted",description:`Job ID: ${o.job_id.slice(0,8)}`}),Oe.getState().addJob(o)},onError:o=>{ue.error({title:"Fit Job Submission Failed",description:o.message})}})}function Ds(e){const t=F(o=>o.backendUrl),r=Oe(o=>o.jobs.find(n=>n.job_id===e));return It({queryKey:["fit_job_status",e],queryFn:async()=>(await E.get(`${t}/fit/status/${e}/`)).data,enabled:!!e&&(r?.status==="pending"||r?.status==="processing"),refetchInterval:o=>{const n=o.state.data?.status;return n==="completed"||n==="failed"?!1:3e3}})}function Ls(){const e=F(t=>t.backendUrl);return Tr({mutationFn:async({sourceId:t,tags:r})=>{try{return(await E.post(`${e}/fit/save/${t}/`,{tags:r||[]})).data}catch(o){if(E.isAxiosError(o)&&o.response){const n=o.response.data;let s="Unknown error";throw n?.detail?Array.isArray(n.detail)?s=n.detail.map(a=>`${a.loc.join(".")} -> ${a.msg}`).join(`
`):typeof n.detail=="object"?s=JSON.stringify(n.detail):s=String(n.detail):n?.message?s=n.message:s=o.message,new Error(`Fit save failed:
${s}`)}throw o}},onSuccess:t=>{ue.success({title:"Fit Result Saved",description:t.message})},onError:t=>{ue.error({title:"Fit Save Failed",description:t.message})}})}function Us({page:e=1,pageSize:t=20,sortDesc:r=!0,enabled:o=!0}){return re({queryKey:["catalog",e,t,r],path:"/fit/catalog/",axiosGetParams:{params:{page:e,page_size:t,sort_desc:r}},enabled:o,queryOptions:{placeholderData:xo}})}export{As as A,js as B,Oe as C,Rs as D,Ds as E,Ls as F,jo as G,Ts as H,Vs as I,ws as J,We as P,jt as R,$n as T,_r as V,Gn as a,st as b,it as c,Uo as d,Do as e,qe as f,Ot as g,Ft as h,N as i,Ce as j,re as k,_s as l,Es as m,pt as n,Ns as o,Ss as p,Fs as q,Os as r,Mt as s,ks as t,Us as u,xs as v,Kn as w,Is as x,Ms as y,gs as z};
