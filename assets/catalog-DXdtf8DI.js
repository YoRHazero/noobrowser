import{g as Pe,r as m,m as w,j as t,f as E,a9 as je,aa as Z,h as B,ab as Se,ac as X,u as ve,ad as Ce,ae as ye,af as ze,ag as K,d as Te,e as Ne,l as Re,B as f,H as S,ah as Ie,a as N,S as y,ai as A,aj as te,ak as we,b as re,al as Ee,am as Me,an as ee,ao as Fe}from"./index-Do8gBRn6.js";import{d as V,e as Le,T as g,B as R,u as oe,b as $e}from"./connection-D3M_8NiJ.js";import{u as _,c as ke,S as Ae,a as _e,b as We,d as Ge,e as Je,f as De,g as Ue,T as q,C as Ve,h as qe,i as He,j as Oe,k as Be,l as Ke,m as G,n as Ye,G as se,N as Qe,o as Xe}from"./useNedSearch-D07WKHsB.js";import{H as I,I as ae}from"./image-BGJo3Kbq.js";const[ne,M]=Pe({name:"PaginationContext",hookName:"usePaginationContext",providerName:"<PaginationProvider />"}),Ze=e=>e.children(M()),et=V(),ie=m.forwardRef((e,r)=>{const[o,s]=et(e,["index"]),a=M(),n=w(a.getEllipsisProps(o),s);return t.jsx(E.div,{...n,ref:r})});ie.displayName="PaginationEllipsis";const tt=V(),le=m.forwardRef((e,r)=>{const[o,s]=tt(e,["value","type"]),a=M(),n=w(a.getItemProps(o),s);return t.jsx(E.button,{...n,ref:r})});le.displayName="PaginationItem";const ce=m.forwardRef((e,r)=>{const o=M(),s=w(o.getNextTriggerProps(),e);return t.jsx(E.button,{...s,ref:r})});ce.displayName="PaginationNextTrigger";const de=m.forwardRef((e,r)=>{const o=M(),s=w(o.getPrevTriggerProps(),e);return t.jsx(E.button,{...s,ref:r})});de.displayName="PaginationPrevTrigger";var rt=Se("pagination").parts("root","item","ellipsis","prevTrigger","nextTrigger"),$=rt.build(),ot=e=>e.ids?.root??`pagination:${e.id}`,st=e=>e.ids?.prevTrigger??`pagination:${e.id}:prev`,at=e=>e.ids?.nextTrigger??`pagination:${e.id}:next`,nt=(e,r)=>e.ids?.ellipsis?.(r)??`pagination:${e.id}:ellipsis:${r}`,it=(e,r)=>e.ids?.item?.(r)??`pagination:${e.id}:item:${r}`,J=(e,r)=>{let o=r-e+1;return Array.from({length:o},(s,a)=>a+e)},lt=e=>e.map(r=>typeof r=="number"?{type:"page",value:r}:{type:"ellipsis"}),D="ellipsis",ct=e=>{const{page:r,totalPages:o,siblingCount:s}=e,a=Math.min(2*s+5,o),n=1,l=o,d=Math.max(r-s,n),c=Math.min(r+s,l),i=d>n+1,u=c<l-1,x=a-2;if(!i&&u)return[...J(1,x),D,l];if(i&&!u){const h=J(l-x+1,l);return[n,D,...h]}if(i&&u){const h=J(d,c);return[n,D,...h,D,l]}return J(n,l)},dt=e=>lt(ct(e));function ut(e,r){const{send:o,scope:s,prop:a,computed:n,context:l}=e,d=n("totalPages"),c=l.get("page"),i=l.get("pageSize"),u=a("translations"),x=a("count"),P=a("getPageUrl"),h=a("type"),T=n("previousPage"),v=n("nextPage"),F=n("pageRange"),W=c===1,b=c===d,C=dt({page:c,totalPages:d,siblingCount:a("siblingCount")});return{count:x,page:c,pageSize:i,totalPages:d,pages:C,previousPage:T,nextPage:v,pageRange:F,slice(j){return j.slice(F.start,F.end)},setPageSize(j){o({type:"SET_PAGE_SIZE",size:j})},setPage(j){o({type:"SET_PAGE",page:j})},goToNextPage(){o({type:"NEXT_PAGE"})},goToPrevPage(){o({type:"PREVIOUS_PAGE"})},goToFirstPage(){o({type:"FIRST_PAGE"})},goToLastPage(){o({type:"LAST_PAGE"})},getRootProps(){return r.element({id:ot(s),...$.root.attrs,dir:a("dir"),"aria-label":u.rootLabel})},getEllipsisProps(j){return r.element({id:nt(s,j.index),...$.ellipsis.attrs,dir:a("dir")})},getItemProps(j){const z=j.value,L=z===c;return r.element({id:it(s,z),...$.item.attrs,dir:a("dir"),"data-index":z,"data-selected":B(L),"aria-current":L?"page":void 0,"aria-label":u.itemLabel?.({page:z,totalPages:d}),onClick(){o({type:"SET_PAGE",page:z})},...h==="button"&&{type:"button"},...h==="link"&&P&&{href:P({page:z,pageSize:i})}})},getPrevTriggerProps(){return r.element({id:st(s),...$.prevTrigger.attrs,dir:a("dir"),"data-disabled":B(W),"aria-label":u.prevTriggerLabel,onClick(){o({type:"PREVIOUS_PAGE"})},...h==="button"&&{disabled:W,type:"button"},...h==="link"&&P&&T&&{href:P({page:T,pageSize:i})}})},getNextTriggerProps(){return r.element({id:at(s),...$.nextTrigger.attrs,dir:a("dir"),"data-disabled":B(b),"aria-label":u.nextTriggerLabel,onClick(){o({type:"NEXT_PAGE"})},...h==="button"&&{disabled:b,type:"button"},...h==="link"&&P&&v&&{href:P({page:v,pageSize:i})}})}}}var gt=je({props({props:e}){return{defaultPageSize:10,siblingCount:1,defaultPage:1,type:"button",count:1,...e,translations:{rootLabel:"pagination",prevTriggerLabel:"previous page",nextTriggerLabel:"next page",itemLabel({page:r,totalPages:o}){return`${o>1&&r===o?"last page, ":""}page ${r}`},...e.translations}}},initialState(){return"idle"},context({prop:e,bindable:r,getContext:o}){return{page:r(()=>({value:e("page"),defaultValue:e("defaultPage"),onChange(s){const a=o();e("onPageChange")?.({page:s,pageSize:a.get("pageSize")})}})),pageSize:r(()=>({value:e("pageSize"),defaultValue:e("defaultPageSize"),onChange(s){e("onPageSizeChange")?.({pageSize:s})}}))}},watch({track:e,context:r,action:o}){e([()=>r.get("pageSize")],()=>{o(["setPageIfNeeded"])})},computed:{totalPages:Z(({prop:e,context:r})=>[r.get("pageSize"),e("count")],([e,r])=>Math.ceil(r/e)),pageRange:Z(({context:e,prop:r})=>[e.get("page"),e.get("pageSize"),r("count")],([e,r,o])=>{const s=(e-1)*r;return{start:s,end:Math.min(s+r,o)}}),previousPage:({context:e})=>e.get("page")===1?null:e.get("page")-1,nextPage:({context:e,computed:r})=>e.get("page")===r("totalPages")?null:e.get("page")+1,isValidPage:({context:e,computed:r})=>e.get("page")>=1&&e.get("page")<=r("totalPages")},on:{SET_PAGE:{guard:"isValidPage",actions:["setPage"]},SET_PAGE_SIZE:{actions:["setPageSize"]},FIRST_PAGE:{actions:["goToFirstPage"]},LAST_PAGE:{actions:["goToLastPage"]},PREVIOUS_PAGE:{guard:"canGoToPrevPage",actions:["goToPrevPage"]},NEXT_PAGE:{guard:"canGoToNextPage",actions:["goToNextPage"]}},states:{idle:{}},implementations:{guards:{isValidPage:({event:e,computed:r})=>e.page>=1&&e.page<=r("totalPages"),isValidCount:({context:e,event:r})=>e.get("page")>r.count,canGoToNextPage:({context:e,computed:r})=>e.get("page")<r("totalPages"),canGoToPrevPage:({context:e})=>e.get("page")>1},actions:{setPage({context:e,event:r,computed:o}){const s=Y(r.page,o("totalPages"));e.set("page",s)},setPageSize({context:e,event:r}){e.set("pageSize",r.size)},goToFirstPage({context:e}){e.set("page",1)},goToLastPage({context:e,computed:r}){e.set("page",r("totalPages"))},goToPrevPage({context:e,computed:r}){e.set("page",o=>Y(o-1,r("totalPages")))},goToNextPage({context:e,computed:r}){e.set("page",o=>Y(o+1,r("totalPages")))},setPageIfNeeded({context:e,computed:r}){r("isValidPage")||e.set("page",1)}}}}),Y=(e,r)=>Math.min(Math.max(e,1),r);X()(["count","dir","getRootNode","id","ids","onPageChange","onPageSizeChange","page","defaultPage","pageSize","defaultPageSize","siblingCount","translations","type","getPageUrl"]);X()(["value","type"]);X()(["index"]);const pt=e=>{const r=m.useId(),{getRootNode:o}=ve(),{dir:s}=Ce(),a={id:r,dir:s,getRootNode:o,...e},n=ye(gt,a);return ut(n,ze)},xt=V(),ue=m.forwardRef((e,r)=>{const[o,s]=xt(e,["count","defaultPage","defaultPageSize","getPageUrl","id","ids","onPageChange","onPageSizeChange","page","pageSize","siblingCount","translations","type"]),a=pt(o),n=w(a.getRootProps(),s);return t.jsx(ne,{value:a,children:t.jsx(E.nav,{...n,ref:r})})});ue.displayName="PaginationRoot";const mt=V(),ge=m.forwardRef((e,r)=>{const[{value:o},s]=mt(e,["value"]),a=w(o.getRootProps(),s);return t.jsx(ne,{value:o,children:t.jsx(E.nav,{...a,ref:r})})});ge.displayName="PaginationRootProvider";const ft=Te("div",{base:{display:"inline-flex",gap:"var(--group-gap, 0.5rem)",isolation:"isolate",position:"relative","& [data-group-item]":{_focusVisible:{zIndex:1}}},variants:{orientation:{horizontal:{flexDirection:"row"},vertical:{flexDirection:"column"}},attached:{true:{gap:"0!"}},grow:{true:{display:"flex","& > *":{flex:1}}},stacking:{"first-on-top":{"& > [data-group-item]":{zIndex:"calc(var(--group-count) - var(--group-index))"}},"last-on-top":{"& > [data-group-item]":{zIndex:"var(--group-index)"}}}},compoundVariants:[{orientation:"horizontal",attached:!0,css:{"& > *[data-first]":{borderEndRadius:"0!",marginEnd:"-1px"},"& > *[data-between]":{borderRadius:"0!",marginEnd:"-1px"},"& > *[data-last]":{borderStartRadius:"0!"}}},{orientation:"vertical",attached:!0,css:{"& > *[data-first]":{borderBottomRadius:"0!",marginBottom:"-1px"},"& > *[data-between]":{borderRadius:"0!",marginBottom:"-1px"},"& > *[data-last]":{borderTopRadius:"0!"}}}],defaultVariants:{orientation:"horizontal"}}),pe=m.memo(m.forwardRef(function(r,o){const{align:s="center",justify:a="flex-start",children:n,wrap:l,skip:d,...c}=r,i=m.useMemo(()=>{let u=m.Children.toArray(n).filter(m.isValidElement);if(u.length===1)return u;const x=u.filter(h=>!d?.(h)),P=x.length;return x.length===1?u:u.map(h=>{const T=h.props;if(d?.(h))return h;const v=x.indexOf(h);return m.cloneElement(h,{...T,"data-group-item":"","data-first":K(v===0),"data-last":K(v===P-1),"data-between":K(v>0&&v<P-1),style:{"--group-count":P,"--group-index":v,...T?.style??{}}})})},[n,d]);return t.jsx(ft,{ref:o,alignItems:s,justifyContent:a,flexWrap:l,...c,className:Ne("chakra-group",r.className),children:i})}));pe.displayName="Group";const{withProvider:xe,withContext:H}=Re({key:"pagination"});xe(ge,"root",{forwardAsChild:!0,forwardProps:["page"]});const ht=xe(ue,"root",{forwardAsChild:!0,forwardProps:["page"]}),bt=H(ie,"ellipsis",{forwardAsChild:!0}),Pt=H(le,"item",{forwardAsChild:!0}),jt=H(ce,"nextTrigger",{forwardAsChild:!0}),St=H(de,"prevTrigger",{forwardAsChild:!0}),vt=Ze;m.forwardRef(function(r,o){const{format:s="compact",...a}=r,{page:n,totalPages:l,pageRange:d,count:c}=M(),i=m.useMemo(()=>s==="short"?`${n} / ${l}`:s==="compact"?`${n} of ${l}`:`${d.start+1} - ${Math.min(d.end,c)} of ${c}`,[s,n,l,d,c]);return t.jsx(f,{fontWeight:"medium",ref:o,...a,children:i})});const Ct=({jobId:e,enabled:r=!0,model_name:o,subtract_model_list:s})=>{const a={};o&&(a.model_name=o),s!=null&&(a.subtract_model_list=s);const n=`/plot/catalog/${e}/spectrum`;return _({queryKey:["plot","catalog","spectrum",e,o??null,s==null?null:s.join(",")],path:n,enabled:r&&!!e,axiosGetParams:{params:a,paramsSerializer:{indexes:null},responseType:"blob"}})},yt=({jobId:e,enabled:r=!0,model_name:o,subtract_model_list:s})=>{const a={};o&&(a.model_name=o),s!=null&&(a.subtract_model_list=s);const n=`/plot/catalog/${e}/posterior`;return _({queryKey:["plot","catalog","posterior",e,o??null,s==null?null:s.join(",")],path:n,enabled:r&&!!e,axiosGetParams:{params:a,paramsSerializer:{indexes:null},responseType:"blob"}})},zt=({jobId:e,enabled:r=!0,model_name:o,subtract_model_list:s})=>{const a={};o&&(a.model_name=o),s!=null&&(a.subtract_model_list=s);const n=`/plot/catalog/${e}/trace`;return _({queryKey:["plot","catalog","trace",e,o??null,s==null?null:s.join(",")],path:n,enabled:r&&!!e,axiosGetParams:{params:a,paramsSerializer:{indexes:null},responseType:"blob"}})},Tt=({jobId:e,enabled:r=!0})=>{const o=`/plot/catalog/${e}/comparison`;return _({queryKey:["plot","catalog","comparison",e],path:o,enabled:r&&!!e,axiosGetParams:{responseType:"blob"}})},p=Le()((e,r)=>({selectedSourceId:null,selectedSource:null,selectedFitJobId:null,selectedPlotModelName:null,subtractModelList:null,page:1,pageSize:20,sortDesc:!0,user:null,setPage:o=>e({page:o}),setPageSize:o=>e({pageSize:o}),setSortDesc:o=>e({sortDesc:o}),setUser:o=>e({user:o}),setSelectedSource:o=>e({selectedSource:o,selectedSourceId:o?.id??null,selectedFitJobId:null,selectedPlotModelName:null,subtractModelList:null}),toggleSelectedSource:o=>e(s=>s.selectedSourceId===o.id?{selectedSource:null,selectedSourceId:null,selectedFitJobId:null,selectedPlotModelName:null,subtractModelList:null}:{selectedSource:o,selectedSourceId:o.id,selectedFitJobId:null,selectedPlotModelName:null,subtractModelList:null}),clearSelection:()=>e({selectedSource:null,selectedSourceId:null,selectedFitJobId:null,selectedPlotModelName:null,subtractModelList:null}),setSelectedFitJobId:o=>e(s=>s.selectedFitJobId===o?s:{selectedFitJobId:o,selectedPlotModelName:null,subtractModelList:null}),setSelectedPlotModelName:o=>e({selectedPlotModelName:o}),setSubtractModelList:o=>e({subtractModelList:o}),syncSelectedSource:o=>{const{selectedSourceId:s}=r();!s||s!==o.id||e({selectedSource:o})}}));function me(e){return[...e].sort((r,o)=>{const s=r.created_at?new Date(r.created_at).getTime():0;return(o.created_at?new Date(o.created_at).getTime():0)-s})}function Nt(e){return me(e)[0]?.job_id??null}function Rt(){const e=p(i=>i.selectedSource),r=p(i=>i.selectedFitJobId),o=p(i=>i.setSelectedFitJobId),s=p(i=>i.selectedPlotModelName),a=p(i=>i.setSelectedPlotModelName),n=p(i=>i.subtractModelList),l=p(i=>i.setSubtractModelList),d=m.useMemo(()=>e?.fit_history?me(e.fit_history):[],[e]),c=m.useMemo(()=>r?d.find(i=>i.job_id===r)??null:null,[d,r]);return m.useEffect(()=>{if(!e){r!==null&&o(null);return}if(d.length===0){r!==null&&o(null);return}if(d.find(x=>x.job_id===r))return;const u=Nt(d);u&&u!==r&&o(u)},[d,r,e,o]),m.useEffect(()=>{if(!c){s!==null&&a(null),n!==null&&l(null);return}const i=Object.keys(c.trace_url_dict??{}),u=c.best_model_name??i[0]??null;(!s||!i.includes(s))&&(a(u),n!==null&&l(null))},[c,s,a,n,l]),{selectedSource:e,fitHistory:d,selectedFitEntry:c,selectedFitJobId:r,setSelectedFitJobId:o,selectedPlotModelName:s,setSelectedPlotModelName:a,subtractModelList:n,setSubtractModelList:l}}function It(){const{selectedSource:e,fitHistory:r,selectedFitEntry:o,selectedFitJobId:s,setSelectedFitJobId:a,selectedPlotModelName:n,setSelectedPlotModelName:l}=Rt(),d=Object.keys(o?.trace_url_dict??{}),c=m.useMemo(()=>ke({items:d.map(i=>({label:i,value:i}))}),[d]);return e?t.jsxs(f,{p:4,borderWidth:"1px",borderColor:"border.muted",borderRadius:"lg",bg:"bg.surface",children:[t.jsxs(S,{justify:"space-between",mb:3,align:"center",flexWrap:"wrap",children:[t.jsx(I,{size:"sm",children:"Fit History"}),t.jsxs(S,{gap:3,flexWrap:"wrap",children:[d.length>0&&t.jsxs(Ae,{collection:c,size:"xs",value:n?[n]:[],onValueChange:i=>l(i.value[0]??null),children:[t.jsx(_e,{minW:"180px",bg:"transparent",borderColor:"border.muted",color:"fg.muted",fontSize:"xs",children:t.jsx(We,{placeholder:"Select model config"})}),t.jsx(Ie,{children:t.jsx(Ge,{children:t.jsx(Je,{bg:"bg.surface",borderColor:"border.muted",children:c.items.map(i=>t.jsx(De,{item:i,children:i.label},i.value))})})})]}),t.jsx(N,{size:"xs",variant:"ghost",disabled:!0,children:"Delete Selected"})]})]}),r.length===0?t.jsx(g,{color:"fg.muted",children:"No fit results available."}):t.jsx(y,{gap:2,maxH:"280px",overflowY:"auto",children:r.map(i=>{const u=i.job_id===s,x=Object.keys(i.trace_url_dict??{});return t.jsx(f,{p:3,borderWidth:"1px",borderColor:u?"blue.300":"border.muted",borderRadius:"md",bg:u?"blue.50":"transparent",cursor:"pointer",onClick:()=>a(i.job_id),children:t.jsxs(S,{justify:"space-between",align:"start",children:[t.jsxs(f,{flex:1,minW:0,children:[t.jsxs(S,{gap:2,flexWrap:"wrap",children:[t.jsx(g,{fontSize:"sm",fontWeight:"medium",truncate:!0,children:i.created_at??i.job_id}),i.best_model_name&&t.jsx(R,{size:"xs",variant:"surface",children:i.best_model_name}),u&&t.jsx(R,{size:"xs",colorPalette:"blue",children:"Selected"})]}),t.jsxs(g,{fontSize:"xs",color:"fg.muted",children:["Job ID: ",i.job_id]}),t.jsxs(S,{gap:1,mt:2,flexWrap:"wrap",children:[t.jsx(g,{fontSize:"xs",color:"fg.muted",children:"Fit Configurations:"}),x.length>0?x.map(P=>t.jsx(R,{size:"xs",variant:"outline",children:P},P)):t.jsx(R,{size:"xs",variant:"outline",children:"None"})]})]}),t.jsx(A,{"aria-label":"Delete fit result",size:"xs",variant:"ghost",disabled:!0,onClick:P=>P.stopPropagation(),children:t.jsx(te,{})})]})},i.job_id)})})]}):t.jsx(f,{p:4,borderWidth:"1px",borderColor:"border.muted",borderRadius:"lg",bg:"bg.surface",children:t.jsx(g,{color:"fg.muted",children:"Select a source to view fit history."})})}function wt(e={}){const{page:r=1,page_size:o=20,sort_desc:s=!0,user:a}=e,n=oe(c=>c.username),l=a??n;return _({queryKey:["catalog",r,o,s,l],path:"/catalog/",axiosGetParams:{params:{page:r,page_size:o,sort_desc:s,user:l}}})}function Et(){const e=oe(s=>s.backendUrl),r=we();return Ue({mutationFn:async s=>{const a=`${e}/catalog/${s}/`;return(await $e.delete(a)).data},onSuccess:()=>{r.invalidateQueries({queryKey:["catalog"]})}})}function Mt(){const e=p(c=>c.page),r=p(c=>c.pageSize),o=p(c=>c.sortDesc),s=p(c=>c.user),a=p(c=>c.setPage),n=p(c=>c.setPageSize),l=p(c=>c.setSortDesc),d=p(c=>c.setUser);return{page:e,pageSize:r,sortDesc:o,user:s,setPage:a,setPageSize:n,setSortDesc:l,setUser:d}}function fe(){const e=p(l=>l.selectedSourceId),r=p(l=>l.selectedSource),o=p(l=>l.toggleSelectedSource),s=p(l=>l.setSelectedSource),a=p(l=>l.clearSelection),n=p(l=>l.syncSelectedSource);return{selectedSourceId:e,selectedSource:r,toggleSelectedSource:o,setSelectedSource:s,clearSelection:a,syncSelectedSource:n}}function Ft(){const{page:e,pageSize:r,sortDesc:o,user:s,setPage:a}=Mt(),{selectedSourceId:n,toggleSelectedSource:l,clearSelection:d,syncSelectedSource:c}=fe(),[i,u]=m.useState(null),{data:x,isLoading:P,isError:h,error:T}=wt({page:e,page_size:r,sort_desc:o,user:s??void 0}),v=Et();m.useEffect(()=>{if(!x||!n)return;const b=x.items.find(C=>C.id===n);b&&c(b)},[x,n,c]);const F=m.useMemo(()=>x?`${x.total} sources`:"",[x]),W=()=>{i&&v.mutate(i,{onSuccess:()=>{n===i&&d()},onSettled:()=>u(null)})};return P?t.jsx(f,{p:4,display:"flex",justifyContent:"center",children:t.jsx(re,{})}):h?t.jsxs(f,{p:4,color:"red.500",children:["Error loading catalog: ",T?.message]}):x?t.jsxs(y,{gap:4,h:"full",children:[t.jsxs(f,{children:[t.jsx(g,{fontSize:"sm",color:"fg.muted",children:"Catalog"}),t.jsxs(S,{justify:"space-between",children:[t.jsx(g,{fontWeight:"semibold",children:"Sources"}),t.jsx(g,{fontSize:"xs",color:"fg.muted",children:F})]})]}),i&&t.jsxs(f,{p:3,bg:"red.50",borderWidth:"1px",borderColor:"red.200",borderRadius:"md",children:[t.jsxs(g,{fontSize:"sm",mb:2,children:["Delete entry ",t.jsx("strong",{children:i}),"?"]}),t.jsxs(S,{gap:2,children:[t.jsx(N,{size:"xs",colorPalette:"red",onClick:W,loading:v.isPending,children:"Confirm"}),t.jsx(N,{size:"xs",variant:"ghost",onClick:()=>u(null),children:"Cancel"})]})]}),t.jsx(y,{gap:0,flex:1,overflowY:"auto",children:x.items.map(b=>{const C=n===b.id;return t.jsx(f,{p:3,cursor:"pointer",bg:C?"bg.subtle":"transparent",_hover:{bg:"bg.subtle"},onClick:()=>l(b),borderBottomWidth:"1px",borderColor:"border.muted",children:t.jsxs(S,{justify:"space-between",align:"start",children:[t.jsxs(f,{flex:1,minW:0,children:[t.jsxs(S,{gap:2,children:[t.jsx(g,{fontWeight:"medium",truncate:!0,children:b.id}),C&&t.jsx(R,{size:"xs",colorPalette:"blue",children:"Selected"})]}),t.jsxs(g,{fontSize:"sm",color:"fg.muted",children:["z: ",b.z?.toFixed(3)??"N/A"]}),t.jsx(g,{fontSize:"xs",color:"fg.muted",truncate:!0,children:b.ref_basename})]}),t.jsx(A,{"aria-label":"Delete entry",size:"xs",variant:"ghost",colorPalette:"red",onClick:j=>{j.stopPropagation(),u(b.id)},children:t.jsx(te,{})})]})},b.id)})}),t.jsx(f,{p:2,borderTopWidth:"1px",borderColor:"border.muted",children:t.jsx(ht,{count:x.total,pageSize:r,page:e,onPageChange:b=>a(b.page),siblingCount:1,children:t.jsxs(pe,{gap:2,justify:"center",w:"full",children:[t.jsx(St,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",children:t.jsx(Ee,{})})}),t.jsx(vt,{children:({pages:b})=>b.map((C,j)=>{if(C.type==="page")return t.jsx(Pt,{...C,asChild:!0,children:t.jsx(A,{variant:C.value===x.page?"outline":"ghost",size:"sm",children:C.value})},C.value);const z=b[j-1],L=b[j+1],he=z?.type==="page"?z.value:"start",be=L?.type==="page"?L.value:"end";return t.jsx(bt,{index:j},`ellipsis-${he}-${be}`)})}),t.jsx(jt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",children:t.jsx(Me,{})})})]})})})]}):null}function Lt(e){const[r,o]=m.useState(null);return m.useEffect(()=>{if(!e){o(null);return}const s=URL.createObjectURL(e);return o(s),()=>URL.revokeObjectURL(s)},[e]),r}function O({label:e,blob:r,isFetching:o,error:s}){const a=Lt(r);return t.jsxs(y,{gap:2,align:"center",children:[o&&t.jsx(re,{size:"lg"}),s&&t.jsx(g,{color:"red.400",fontSize:"sm",children:s}),a?t.jsx(ae,{src:a,alt:e,objectFit:"contain",maxH:"800px",w:"full"}):!o&&t.jsx(g,{color:"fg.muted",children:"No plot available."})]})}function $t(){const e=p(s=>s.selectedFitJobId),o=Tt({jobId:e??"",enabled:!!e});return t.jsx(q,{value:"comparison",p:4,children:e?t.jsx(O,{label:"Model Comparison",blob:o.data??null,isFetching:o.isFetching,error:o.isError?o.error?.message:null}):t.jsx(g,{color:"fg.muted",children:"Select a fit result to view plots."})})}function kt(){const e=p(a=>a.selectedFitJobId),r=p(a=>a.selectedPlotModelName),s=yt({jobId:e??"",enabled:!!e,model_name:r});return t.jsx(q,{value:"posterior",p:4,children:e?t.jsx(O,{label:"Posterior",blob:s.data??null,isFetching:s.isFetching,error:s.isError?s.error?.message:null}):t.jsx(g,{color:"fg.muted",children:"Select a fit result to view plots."})})}function At(){const e=p(d=>d.selectedFitJobId),r=p(d=>d.selectedPlotModelName),o=p(d=>d.subtractModelList),s=p(d=>d.setSubtractModelList),a=!!e,n=o!==null,l=Ct({jobId:e??"",enabled:a,model_name:r,subtract_model_list:n?[]:null});return t.jsx(q,{value:"spectrum",p:4,children:e?t.jsxs(S,{align:"start",gap:6,flexWrap:"wrap",children:[t.jsx(f,{minW:"200px",maxW:"240px",children:t.jsxs(y,{gap:3,children:[t.jsx(g,{fontSize:"xs",color:"fg.muted",fontWeight:"semibold",children:"Subtract Models"}),t.jsxs(Ve,{checked:n,size:"sm",colorPalette:"cyan",onCheckedChange:d=>{const c=!!d.checked;s(c?[]:null)},children:[t.jsx(qe,{}),t.jsx(He,{}),t.jsx(Oe,{fontSize:"xs",fontFamily:"mono",children:n?"Show all":"Show default"})]})]})}),t.jsx(f,{flex:1,minW:"240px",children:t.jsx(O,{label:"Spectrum",blob:l.data??null,isFetching:l.isFetching,error:l.isError?l.error?.message:null})})]}):t.jsx(g,{color:"fg.muted",children:"Select a fit result to view plots."})})}function _t(){const e=p(a=>a.selectedFitJobId),r=p(a=>a.selectedPlotModelName),s=zt({jobId:e??"",enabled:!!e,model_name:r});return t.jsx(q,{value:"trace",p:4,children:e?t.jsx(O,{label:"Trace",blob:s.data??null,isFetching:s.isFetching,error:s.isError?s.error?.message:null}):t.jsx(g,{color:"fg.muted",children:"Select a fit result to view plots."})})}function Wt(){const e=p(o=>o.selectedSource),r=p(o=>o.selectedFitJobId);return e?t.jsxs(f,{p:4,borderWidth:"1px",borderColor:"border.muted",borderRadius:"lg",bg:"bg.surface",children:[t.jsx(I,{size:"sm",mb:3,children:"Catalog Plots"}),r?t.jsxs(Be,{defaultValue:"comparison",variant:"enclosed",children:[t.jsxs(Ke,{children:[t.jsx(G,{value:"comparison",children:"Comparison"}),t.jsx(G,{value:"spectrum",children:"Spectrum"}),t.jsx(G,{value:"posterior",children:"Posterior"}),t.jsx(G,{value:"trace",children:"Trace"})]}),t.jsx($t,{}),t.jsx(At,{}),t.jsx(kt,{}),t.jsx(_t,{})]}):t.jsx(g,{color:"fg.muted",children:"No fit result selected."})]}):t.jsx(f,{p:4,borderWidth:"1px",borderColor:"border.muted",borderRadius:"lg",bg:"bg.surface",children:t.jsx(g,{color:"fg.muted",children:"Select a source to view plots."})})}function U(e){return String(e).padStart(2,"0")}function Gt(e){const o=(e%360+360)%360/15,s=Math.floor(o),a=(o-s)*60,n=Math.floor(a),l=(a-n)*60;return`${U(s)}:${U(n)}:${l.toFixed(2).padStart(5,"0")}`}function Jt(e){const r=e<0?"-":"+",o=Math.abs(e),s=Math.floor(o),a=(o-s)*60,n=Math.floor(a),l=(a-n)*60;return`${r}${U(s)}:${U(n)}:${l.toFixed(2).padStart(5,"0")}`}function Q(e){window.open(e,"_blank","noopener,noreferrer")}function k({label:e,value:r}){return t.jsxs(S,{justify:"space-between",align:"start",gap:4,children:[t.jsx(g,{fontSize:"xs",color:"fg.muted",children:e}),t.jsx(g,{fontSize:"sm",textAlign:"right",children:r})]})}function Dt(){const{selectedSource:e}=fe(),[r,o]=m.useState(2),[s,a]=m.useState(!1),{data:n,isFetching:l,refetch:d}=Ye({ra:e?.ra,dec:e?.dec,radius:r,enabled:!1});if(!e)return t.jsx(f,{p:4,borderWidth:"1px",borderColor:"border.muted",borderRadius:"lg",bg:"bg.surface",children:t.jsx(g,{color:"fg.muted",children:"Select a source to view details."})});const c=`https://grizli-cutout.herokuapp.com/thumb?ra=${e.ra}&dec=${e.dec}&size=2&output=png&filters=f182m-clear,f210m-clear,f444w-clear`,i=`https://ned.ipac.caltech.edu/bypos?pos=${e.ra}+${e.dec}`;return t.jsx(f,{p:4,borderWidth:"1px",borderColor:"border.muted",borderRadius:"lg",bg:"bg.surface",children:t.jsxs(y,{gap:3,children:[t.jsxs(f,{children:[t.jsx(I,{size:"md",children:e.id}),t.jsxs(S,{gap:2,mt:2,flexWrap:"wrap",children:[t.jsxs(R,{variant:"surface",children:["z=",e.z?.toFixed(4)??"N/A"]}),e.user&&t.jsx(R,{variant:"outline",children:e.user}),t.jsx(g,{fontSize:"xs",color:"fg.muted",children:e.created_at})]}),t.jsx(g,{fontSize:"xs",fontFamily:"mono",color:"fg.muted",mt:1,children:e.ref_basename})]}),t.jsxs(se,{templateColumns:{base:"1fr",xl:"1.2fr 0.8fr"},gap:4,children:[t.jsxs(y,{gap:3,children:[t.jsx(f,{p:3,borderWidth:"1px",borderColor:"border.muted",borderRadius:"md",children:t.jsxs(y,{gap:2,children:[t.jsx(I,{size:"xs",color:"fg.muted",children:"Source Metadata"}),t.jsx(k,{label:"RA (deg)",value:e.ra.toFixed(6)}),t.jsx(k,{label:"Dec (deg)",value:e.dec.toFixed(6)}),t.jsx(k,{label:"RA/Dec (hms/dms)",value:`${Gt(e.ra)} / ${Jt(e.dec)}`}),t.jsx(k,{label:"Pixel",value:`${e.pixel_x.toFixed(2)}, ${e.pixel_y.toFixed(2)}`}),t.jsx(k,{label:"Tags",value:e.tags.length>0?e.tags.join(", "):"None"})]})}),t.jsxs(f,{p:3,borderWidth:"1px",borderColor:"border.muted",borderRadius:"md",children:[t.jsx(I,{size:"xs",color:"fg.muted",mb:2,children:"NED Lookup"}),t.jsx(g,{fontSize:"sm",color:"fg.muted",children:"Use the position to explore NED entries nearby."}),t.jsxs(y,{mt:3,gap:2,children:[t.jsxs(S,{justify:"space-between",align:"center",children:[t.jsxs(g,{fontSize:"xs",color:"fg.muted",children:[e.ra.toFixed(5),","," ",e.dec.toFixed(5)]}),t.jsxs(N,{size:"xs",variant:"outline",onClick:()=>Q(i),children:["Open NED ",t.jsx(ee,{})]})]}),t.jsxs(S,{gap:2,align:"center",children:[t.jsx(g,{fontSize:"xs",color:"fg.muted",children:"Radius (arcsec)"}),t.jsx(Qe,{size:"xs",width:"90px",value:r.toString(),onValueChange:u=>{const x=Number.parseFloat(u.value);Number.isNaN(x)||o(x)},min:.1,max:120,children:t.jsx(Xe,{})}),t.jsxs(N,{size:"xs",colorPalette:"blue",loading:l,onClick:()=>{a(!0),d()},children:[t.jsx(Fe,{})," Search"]})]}),s&&t.jsx(f,{borderWidth:"1px",borderColor:"border.muted",borderRadius:"md",p:2,maxH:"180px",overflowY:"auto",bg:"bg.subtle",children:l?t.jsx(g,{fontSize:"sm",color:"fg.muted",children:"Searching..."}):n&&n.length>0?t.jsx(y,{gap:2,children:n.map((u,x)=>t.jsxs(S,{justify:"space-between",align:"start",children:[t.jsxs(f,{children:[t.jsx(g,{fontSize:"sm",fontWeight:"medium",children:u.object_name}),t.jsxs(g,{fontSize:"xs",color:"fg.muted",children:["z: ",u.redshift?.toFixed(4)??"N/A"]})]}),t.jsx(N,{size:"xs",variant:"ghost","aria-label":"Open NED result",onClick:()=>Q(u.url),children:t.jsx(ee,{})})]},`${u.object_name}-${x}`))}):t.jsx(g,{fontSize:"sm",color:"fg.muted",children:"No results."})})]})]})]}),t.jsx(y,{gap:3,children:t.jsxs(f,{p:3,borderWidth:"1px",borderColor:"border.muted",borderRadius:"md",children:[t.jsx(I,{size:"xs",color:"fg.muted",mb:2,children:"Cutout Preview"}),t.jsx(ae,{src:c,alt:"Cutout",objectFit:"contain",maxH:"240px",w:"full",borderRadius:"md",borderWidth:"1px",borderColor:"border.muted"}),t.jsx(N,{size:"xs",variant:"ghost",onClick:()=>Q(c),children:"Open image"})]})})]})]})})}function Ut(){return t.jsxs(se,{templateColumns:{base:"1fr",lg:"340px 1fr"},gap:4,p:4,h:"100vh",children:[t.jsx(f,{overflowY:"auto",borderRightWidth:{base:"0px",lg:"1px"},borderColor:"border.muted",pr:{base:0,lg:2},children:t.jsx(Ft,{})}),t.jsx(f,{overflowY:"auto",h:"full",children:t.jsxs(y,{gap:4,children:[t.jsx(Dt,{}),t.jsx(It,{}),t.jsx(Wt,{})]})})]})}function Bt(){return t.jsx(Ut,{})}export{Bt as component};
